<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功夫茶 KUNG FU TEA - 線上點餐</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', '微軟正黑體', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #764ba2;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #666;
            font-size: 1.2rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            height: fit-content;
        }

        .section-title {
            color: #764ba2;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        /* 菜單區域樣式 */
        .category-dropdown {
            margin-bottom: 15px;
        }

        .category-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .category-header:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .category-content {
            display: none;
            padding: 15px 0;
            border-left: 3px solid #667eea;
            margin-left: 10px;
            padding-left: 15px;
        }

        .category-content.active {
            display: block;
        }

        .dropdown-arrow {
            transition: transform 0.3s ease;
        }

        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }

        .beverage-item {
            background: #f8f9ff;
            border: 1px solid #e0e6ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .beverage-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .beverage-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .beverage-prices {
            color: #667eea;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .beverage-notes {
            color: #666;
            font-size: 0.8rem;
            font-style: italic;
        }

        .star {
            color: #ffd700;
            font-weight: bold;
        }

        /* 訂單區域樣式 */
        .customer-info {
            margin-bottom: 20px;
        }

        .info-group {
            margin-bottom: 15px;
        }

        .info-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .info-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e6ff;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .info-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .order-item {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .order-item-header {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-item-details {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-item-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #f0f4ff;
            border-radius: 15px;
            padding: 2px;
        }

        .quantity-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            transition: all 0.2s ease;
        }

        .quantity-btn:hover {
            background: #5a6fd8;
            transform: scale(1.1);
        }

        .quantity-display {
            background: white;
            color: #667eea;
            border-radius: 10px;
            padding: 2px 8px;
            font-weight: bold;
            font-size: 0.9rem;
            min-width: 20px;
            text-align: center;
        }

        .total-section {
            border-top: 2px solid #667eea;
            padding-top: 15px;
            margin-top: 15px;
            text-align: center;
        }

        .total-amount {
            font-size: 1.3rem;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 15px;
        }

        /* 預覽區域樣式 */
        .preview-area {
            background: #f8f9ff;
            border: 2px solid #e0e6ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 200px;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .copy-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            border: 2px solid #ddd;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* 模態框樣式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            color: #764ba2;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .option-group {
            margin: 20px 0;
            text-align: left;
        }

        .option-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .option-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .option-btn {
            background: #f0f4ff;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #667eea;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-btn:hover, .option-btn.selected {
            background: #667eea;
            color: white;
        }

        .quantity-input {
            margin: 20px 0;
        }

        .quantity-input input {
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 10px;
            font-size: 1rem;
            text-align: center;
            width: 80px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .empty-order {
            text-align: center;
            color: #666;
            font-style: italic;
            margin: 20px 0;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .section {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .section-title {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }
            
            .category-header {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .beverage-item {
                padding: 12px;
                margin-bottom: 8px;
            }
            
            .beverage-name {
                font-size: 1rem;
            }
            
            .beverage-prices {
                font-size: 0.85rem;
            }
            
            .beverage-notes {
                font-size: 0.75rem;
            }
            
            .info-group input {
                padding: 12px;
                font-size: 1rem;
            }
            
            .order-item {
                padding: 12px;
            }
            
            .quantity-btn {
                width: 28px;
                height: 28px;
                font-size: 0.9rem;
            }
            
            .quantity-controls {
                gap: 2px;
                padding: 1px;
            }
            
            .quantity-display {
                font-size: 0.8rem;
                padding: 1px 6px;
            }
            
            .order-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .order-item-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .modal-content {
                margin: 5% auto;
                padding: 20px;
                width: 95%;
                max-height: 90vh;
            }
            
            .modal-title {
                font-size: 1.3rem;
            }
            
            .option-buttons {
                gap: 6px;
            }
            
            .option-btn {
                padding: 10px 12px;
                font-size: 0.85rem;
            }
            
            .quantity-input input {
                width: 70px;
                padding: 12px;
            }
            
            .modal-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                padding: 15px;
                font-size: 1rem;
            }
            
            .preview-area {
                font-size: 0.8rem;
                min-height: 150px;
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .section {
                padding: 12px;
            }
            
            .beverage-item {
                padding: 10px;
            }
            
            .category-header {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .modal-content {
                margin: 2% auto;
                padding: 15px;
            }
            
            .option-buttons {
                grid-template-columns: 1fr 1fr;
            }
            
            .option-btn {
                padding: 8px 10px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>功夫茶 KUNG FU TEA</h1>
            <div class="subtitle">線上點餐系統</div>
        </header>

        <div class="main-content">
            <!-- 菜單區域 -->
            <div class="section">
                <h2 class="section-title">菜單</h2>
                <div id="menu-container"></div>
            </div>

            <!-- 訂單區域 -->
            <div class="section">
                <h2 class="section-title">訂購資訊</h2>
                
                <div class="customer-info">
                    <div class="info-group">
                        <label for="customer-name">訂購人姓名</label>
                        <input type="text" id="customer-name" placeholder="請輸入姓名">
                    </div>
                    <div class="info-group">
                        <label for="customer-phone">聯絡電話</label>
                        <input type="tel" id="customer-phone" placeholder="聯絡電話or公司電話#分機">
                    </div>
                    <div class="info-group">
                        <label for="delivery-address">外送地址</label>
                        <input type="text" id="delivery-address" placeholder="外送地址+(公司行號)">
                    </div>
                </div>

                <h3 style="color: #764ba2; margin-bottom: 15px;">您的訂單</h3>
                <div id="order-container">
                    <div class="empty-order">尚未選擇任何飲品</div>
                </div>
                
                <div class="total-section">
                    <div class="total-amount">總計: $<span id="total-amount">0</span></div>
                    <button class="btn btn-secondary" id="save-order">💾 儲存訂單</button>
                    <button class="btn btn-secondary" id="load-orders">📋 載入訂單</button>
                    <button class="btn btn-secondary" id="clear-order">清空訂單</button>
                </div>
            </div>

            <!-- 預覽區域 -->
            <div class="section">
                <h2 class="section-title">訂單預覽</h2>
                <div class="preview-area" id="order-preview">請先填寫訂購資訊和選擇飲品...</div>
                <button class="copy-btn" id="copy-order" disabled>📋 複製訂單文字</button>
                <button class="btn btn-primary" id="send-order" disabled>📱 發送給店家</button>
            </div>
        </div>
    </div>

    <!-- 選擇選項的模態框 -->
    <div id="order-modal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title">選擇飲品選項</h3>
            
            <div class="option-group">
                <label>尺寸價格</label>
                <div class="option-buttons" id="size-options"></div>
            </div>

            <div class="option-group" id="sugar-group">
                <label>甜度</label>
                <div class="option-buttons" id="sugar-options">
                    <div class="option-btn selected" data-value="正糖">正糖</div>
                    <div class="option-btn" data-value="少糖">少糖</div>
                    <div class="option-btn" data-value="半糖">半糖</div>
                    <div class="option-btn" data-value="微糖">微糖</div>
                    <div class="option-btn" data-value="無糖">無糖</div>
                </div>
            </div>

            <div class="option-group" id="ice-group">
                <label>冰塊</label>
                <div class="option-buttons" id="ice-options">
                    <div class="option-btn selected" data-value="正冰">正冰</div>
                    <div class="option-btn" data-value="少冰">少冰</div>
                    <div class="option-btn" data-value="微冰">微冰</div>
                    <div class="option-btn" data-value="去冰">去冰</div>
                    <div class="option-btn" data-value="熱飲">熱飲</div>
                </div>
            </div>

            <div class="option-group" id="toppings-group" style="display: none;">
                <label>加料選擇</label>
                <div class="option-buttons" id="toppings-options"></div>
            </div>
            
            <div class="quantity-input">
                <label for="quantity">數量: </label>
                <input type="number" id="quantity" min="1" value="1">
            </div>
            
            <div class="modal-buttons">
                <button class="btn btn-primary" id="add-to-order">加入訂單</button>
                <button class="btn btn-secondary" id="cancel-order">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 加料選項資料
        const toppings = [
            {name: "黑糖波霸", price: 10, displayName: "波霸"},
            {name: "仙草", price: 10, displayName: "仙草"},
            {name: "寒天球", price: 10, displayName: "寒天球"},
            {name: "蒟蒻", price: 10, displayName: "蒟蒻"},
            {name: "愛玉", price: 10, displayName: "愛玉"},
            {name: "38料粉條", price: 10, displayName: "38料粉條"}
        ];

        // 飲品資料
        const menuData = [
            // 功夫・好友茶
            {name: "功夫茶王", category: "功夫・好友茶", prices: {'L': 45}, notes: "★ 無糖微冰限定, 不可加料", fixedOptions: {sugar: "無糖", ice: "微冰"}, canAddToppings: false},
            {name: "岩葉紅茶", category: "功夫・好友茶", prices: {'L': 35, '瓶': 55}, canAddToppings: true},
            {name: "翠玉綠茶", category: "功夫・好友茶", prices: {'L': 35, '瓶': 55}, canAddToppings: true},
            {name: "四季春青茶", category: "功夫・好友茶", prices: {'L': 35, '瓶': 55}, canAddToppings: true},
            {name: "烏龍觀音", category: "功夫・好友茶", prices: {'L': 35, '瓶': 55}, canAddToppings: true},
            {name: "蜜桃胭脂紅茶", category: "功夫・好友茶", prices: {'L': 40, '瓶': 60}, canAddToppings: true},
            {name: "手作冬瓜茶", category: "功夫・好友茶", prices: {'L': 35}, notes: "無另外加糖", noSugarOptions: true, canAddToppings: true},
            {name: "阿里山冰茶", category: "功夫・好友茶", prices: {'L': 50}, notes: "推薦, 不可加料", canAddToppings: false},
            {name: "日月潭紅玉", category: "功夫・好友茶", prices: {'L': 50}, notes: "推薦, 不可加料", canAddToppings: false},

            // 特調系列
            {name: "芝士奶蓋綠茶/青茶", category: "特調", prices: {'L': 70}, canAddToppings: true},
            {name: "芝士奶蓋紅茶/烏龍", category: "特調", prices: {'L': 70}, canAddToppings: true},
            {name: "玫瑰冰茶", category: "特調", prices: {'L': 55}, notes: "無另外加糖", noSugarOptions: true, canAddToppings: true},
            {name: "青梅綠茶", category: "特調", prices: {'L': 55}, canAddToppings: true},
            {name: "多多綠茶", category: "特調", prices: {'L': 60}, canAddToppings: true},
            {name: "胭脂多多", category: "特調", prices: {'L': 60}, canAddToppings: true},
            {name: "粉粿胭脂紅", category: "特調", prices: {'L': 50}, canAddToppings: true},
            {name: "冰淇淋岩葉紅茶", category: "特調", prices: {'L': 60}, notes: "最佳風味", canAddToppings: true},

            // 功夫・鮮奶
            {name: "黑糖波霸鮮奶", category: "功夫・鮮奶", prices: {'M': 65, 'L': 80}, notes: "無另外加糖", noSugarOptions: true, canAddToppings: true},
            {name: "紅豆粉粿鮮奶", category: "功夫・鮮奶", prices: {'M': 65, 'L': 80}, notes: "★ 甜度固定", fixedOptions: {sugar: "甜度固定"}, canAddToppings: true},
            {name: "巧克力鮮奶", category: "功夫・鮮奶", prices: {'L': 75}, canAddToppings: true},
            {name: "岩葉紅茶拿鐵", category: "功夫・鮮奶", prices: {'M': 55, 'L': 65}, canAddToppings: true},
            {name: "烏龍觀音拿鐵", category: "功夫・鮮奶", prices: {'M': 55, 'L': 65}, canAddToppings: true},
            {name: "英式伯爵拿鐵", category: "功夫・鮮奶", prices: {'L': 70}, canAddToppings: true},
            {name: "蜜桃胭脂拿鐵", category: "功夫・鮮奶", prices: {'L': 70}, canAddToppings: true},
            {name: "冰淇淋紅茶拿鐵", category: "功夫・鮮奶", prices: {'L': 75}, notes: "最低微冰", fixedOptions: {ice: "微冰"}, canAddToppings: true},

            // 功夫・奶茶
            {name: "38奶霸", category: "功夫・奶茶", prices: {'M': 60, 'L': 65}, notes: "★ 含波霸+蒟蒻+仙草", canAddToppings: false},
            {name: "黑糖波霸奶茶", category: "功夫・奶茶", prices: {'M': 55, 'L': 60}, notes: "★", canAddToppings: true},
            {name: "咖啡凍奶茶", category: "功夫・奶茶", prices: {'M': 60, 'L': 65}, canAddToppings: true},
            {name: "厚奶茶/奶綠", category: "功夫・奶茶", prices: {'M': 50, 'L': 55}, canAddToppings: true},
            {name: "烏龍觀音奶茶", category: "功夫・奶茶", prices: {'M': 50, 'L': 55}, canAddToppings: true},
            {name: "英式伯爵奶茶", category: "功夫・奶茶", prices: {'L': 65}, canAddToppings: true},
            {name: "蜜桃胭脂奶茶", category: "功夫・奶茶", prices: {'L': 65}, canAddToppings: true},
            {name: "莊園玫瑰奶茶", category: "功夫・奶茶", prices: {'L': 65}, canAddToppings: true},
            {name: "巧克力奶茶", category: "功夫・奶茶", prices: {'L': 65}, canAddToppings: true},

            // 期間・限定
            {name: "星桃樂胭脂", category: "期間・限定", prices: {'單一價': 75}, canAddToppings: true},

            // 功夫・水果
            {name: "輕飲水果茶王", category: "功夫・水果", prices: {'L': 65}, canAddToppings: true},
            {name: "寒天柚香飲", category: "功夫・水果", prices: {'L': 65}, canAddToppings: true},
            {name: "粉裸柚香綠", category: "功夫・水果", prices: {'L': 65}, canAddToppings: true},
            {name: "鮮榨柳橙綠", category: "功夫・水果", prices: {'L': 65}, notes: "推薦, 甜度固定", fixedOptions: {sugar: "甜度固定"}, canAddToppings: true},
            {name: "芭樂檸檬綠", category: "功夫・水果", prices: {'L': 70}, notes: "★ 固定半糖微冰", fixedOptions: {sugar: "半糖", ice: "微冰"}, canAddToppings: true},
            {name: "黃金芒果綠", category: "功夫・水果", prices: {'L': 60}, canAddToppings: true},
            {name: "百香3Q", category: "功夫・水果", prices: {'L': 60}, notes: "不含咖啡因, 含波霸+蒟蒻+椰果", canAddToppings: false},
            {name: "百香羅勒子", category: "功夫・水果", prices: {'L': 55}, notes: "不含茶", canAddToppings: true},
            {name: "冬瓜檸檬", category: "功夫・水果", prices: {'L': 55}, notes: "不含另外加糖", noSugarOptions: true, canAddToppings: true},
            {name: "黃金芒果莎莎", category: "功夫・水果", prices: {'L': 60}, notes: "★ 冰沙", fixedOptions: {sugar: "", ice: "冰沙"}, noSugarOptions: true, canAddToppings: false},
            {name: "泰式榴槤莎莎", category: "功夫・水果", prices: {'L': 110}, notes: "★ 熱銷限定, 冰沙", fixedOptions: {sugar: "", ice: "冰沙"}, noSugarOptions: true, canAddToppings: false},
        ];

        // 全域變數
        let currentOrder = [];
        let currentBeverage = null;
        let savedOrders = JSON.parse(localStorage.getItem('kungfuTeaOrders') || '[]');

        // DOM 元素
        const menuContainer = document.getElementById('menu-container');
        const orderContainer = document.getElementById('order-container');
        const totalAmountEl = document.getElementById('total-amount');
        const orderPreview = document.getElementById('order-preview');
        const copyOrderBtn = document.getElementById('copy-order');
        const sendOrderBtn = document.getElementById('send-order');
        const clearOrderBtn = document.getElementById('clear-order');
        const saveOrderBtn = document.getElementById('save-order');
        const loadOrdersBtn = document.getElementById('load-orders');
        const modal = document.getElementById('order-modal');
        const modalTitle = document.getElementById('modal-title');
        const sizeOptions = document.getElementById('size-options');
        const quantityInput = document.getElementById('quantity');
        const addToOrderBtn = document.getElementById('add-to-order');
        const cancelOrderBtn = document.getElementById('cancel-order');

        // 訂購資訊輸入框
        const customerName = document.getElementById('customer-name');
        const customerPhone = document.getElementById('customer-phone');
        const deliveryAddress = document.getElementById('delivery-address');

        // 初始化菜單
        function initMenu() {
            const categories = [...new Set(menuData.map(item => item.category))];
            
            categories.forEach(category => {
                const categoryDropdown = document.createElement('div');
                categoryDropdown.className = 'category-dropdown';

                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                categoryHeader.innerHTML = `
                    ${category}
                    <span class="dropdown-arrow">▼</span>
                `;

                const categoryContent = document.createElement('div');
                categoryContent.className = 'category-content';

                // 創建該分類下的飲品
                const categoryItems = menuData.filter(item => item.category === category);
                categoryItems.forEach(beverage => {
                    const beverageEl = createBeverageElement(beverage);
                    categoryContent.appendChild(beverageEl);
                });

                // 點擊標題切換展開/收起
                categoryHeader.addEventListener('click', () => {
                    const arrow = categoryHeader.querySelector('.dropdown-arrow');
                    const isActive = categoryContent.classList.contains('active');
                    
                    if (isActive) {
                        categoryContent.classList.remove('active');
                        arrow.classList.remove('rotated');
                    } else {
                        categoryContent.classList.add('active');
                        arrow.classList.add('rotated');
                    }
                });

                categoryDropdown.appendChild(categoryHeader);
                categoryDropdown.appendChild(categoryContent);
                menuContainer.appendChild(categoryDropdown);
            });
        }

        // 創建飲品元素
        function createBeverageElement(beverage) {
            const beverageEl = document.createElement('div');
            beverageEl.className = 'beverage-item';
            beverageEl.onclick = () => openOrderModal(beverage);

            const pricesText = Object.entries(beverage.prices)
                .map(([size, price]) => `${size} $${price}`)
                .join(' / ');

            let notesHtml = '';
            if (beverage.notes) {
                // 移除備註中的星星圖示，因為已經移到名稱前面
                const cleanNotes = beverage.notes.replace(/★\s*/g, '');
                if (cleanNotes.trim()) {
                    notesHtml = `<div class="beverage-notes">${cleanNotes}</div>`;
                }
            }

            // 處理星星圖示
            let displayName = beverage.name;
            if (beverage.notes && beverage.notes.includes('★')) {
                displayName = `<span class="star">★</span> ${beverage.name}`;
            }

            beverageEl.innerHTML = `
                <div class="beverage-name">${displayName}</div>
                <div class="beverage-prices">${pricesText}</div>
                ${notesHtml}
            `;

            return beverageEl;
        }

        // 打開訂購模態框
        function openOrderModal(beverage) {
            currentBeverage = beverage;
            modalTitle.textContent = beverage.name;
            
            // 創建尺寸選項
            sizeOptions.innerHTML = '';
            const sizes = Object.keys(beverage.prices);
            
            sizes.forEach((size, index) => {
                const sizeBtn = document.createElement('div');
                sizeBtn.className = 'option-btn';
                if (index === 0) sizeBtn.classList.add('selected');
                sizeBtn.textContent = `${size} (${beverage.prices[size]})`;
                sizeBtn.onclick = () => selectOption(sizeBtn, 'size');
                sizeOptions.appendChild(sizeBtn);
            });

            // 處理甜度選項
            const sugarGroup = document.getElementById('sugar-group');
            if (beverage.fixedOptions?.sugar || beverage.noSugarOptions) {
                sugarGroup.style.display = 'none';
            } else {
                sugarGroup.style.display = 'block';
                resetSugarSelections();
            }

            // 處理冰塊選項
            const iceGroup = document.getElementById('ice-group');
            if (beverage.fixedOptions?.ice) {
                iceGroup.style.display = 'none';
            } else {
                iceGroup.style.display = 'block';
                resetIceSelections();
            }

            // 處理加料選項
            const toppingsGroup = document.getElementById('toppings-group');
            if (beverage.canAddToppings) {
                toppingsGroup.style.display = 'block';
                createToppingsOptions();
            } else {
                toppingsGroup.style.display = 'none';
            }

            quantityInput.value = 1;
            modal.style.display = 'block';
        }

        // 創建加料選項
        function createToppingsOptions() {
            const toppingsContainer = document.getElementById('toppings-options');
            toppingsContainer.innerHTML = '';
            
            toppings.forEach(topping => {
                const toppingBtn = document.createElement('div');
                toppingBtn.className = 'option-btn';
                toppingBtn.textContent = `${topping.name} (+${topping.price})`;
                toppingBtn.dataset.toppingName = topping.name;
                toppingBtn.dataset.toppingPrice = topping.price;
                toppingBtn.onclick = () => toggleTopping(toppingBtn);
                toppingsContainer.appendChild(toppingBtn);
            });
        }

        // 切換加料選擇
        function toggleTopping(btn) {
            btn.classList.toggle('selected');
        }

        // 選擇選項 (尺寸、甜度、冰塊)
        function selectOption(btn, type) {
            const parentContainer = btn.parentNode;
            parentContainer.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }

        // 重置甜度選項
        function resetSugarSelections() {
            document.querySelectorAll('#sugar-options .option-btn').forEach((btn, index) => {
                btn.classList.toggle('selected', index === 0);
            });
        }

        // 重置冰塊選項
        function resetIceSelections() {
            document.querySelectorAll('#ice-options .option-btn').forEach((btn, index) => {
                btn.classList.toggle('selected', index === 0);
            });
        }

        // 加入訂單
        addToOrderBtn.onclick = () => {
            const selectedSizeBtn = document.querySelector('#size-options .option-btn.selected');
            const sizeText = selectedSizeBtn.textContent;
            const size = sizeText.split(' ')[0];
            const quantity = parseInt(quantityInput.value);

            if (quantity <= 0) {
                alert('數量必須大於 0');
                return;
            }

            // 處理甜度選項
            let sugar = "正糖";
            if (currentBeverage.fixedOptions?.sugar) {
                sugar = currentBeverage.fixedOptions.sugar;
            } else if (currentBeverage.noSugarOptions) {
                sugar = ""; // 不顯示甜度
            } else {
                const selectedSugarBtn = document.querySelector('#sugar-options .option-btn.selected');
                if (selectedSugarBtn) {
                    sugar = selectedSugarBtn.dataset.value;
                }
            }

            // 處理冰塊選項
            let ice = "正冰";
            if (currentBeverage.fixedOptions?.ice) {
                ice = currentBeverage.fixedOptions.ice;
            } else {
                const selectedIceBtn = document.querySelector('#ice-options .option-btn.selected');
                if (selectedIceBtn) {
                    ice = selectedIceBtn.dataset.value;
                }
            }

            // 處理加料選項
            const selectedToppings = [];
            let toppingsPrice = 0;
            if (currentBeverage.canAddToppings) {
                document.querySelectorAll('#toppings-options .option-btn.selected').forEach(btn => {
                    const toppingName = btn.dataset.toppingName;
                    const toppingPrice = parseInt(btn.dataset.toppingPrice);
                    selectedToppings.push(toppingName);
                    toppingsPrice += toppingPrice;
                });
            }

            const basePrice = currentBeverage.prices[size];
            const totalPrice = (basePrice + toppingsPrice) * quantity;

            const orderItem = {
                beverage: currentBeverage,
                size: size,
                sugar: sugar,
                ice: ice,
                toppings: selectedToppings,
                quantity: quantity,
                price: totalPrice
            };

            currentOrder.push(orderItem);
            updateOrderDisplay();
            updateOrderPreview();
            modal.style.display = 'none';
        };

        // 取消訂購
        cancelOrderBtn.onclick = () => {
            modal.style.display = 'none';
        };

        // 更新訂單顯示
        function updateOrderDisplay() {
            if (currentOrder.length === 0) {
                orderContainer.innerHTML = '<div class="empty-order">尚未選擇任何飲品</div>';
            } else {
                orderContainer.innerHTML = '';
                currentOrder.forEach((item, index) => {
                    const orderItemEl = createOrderItemElement(item, index);
                    orderContainer.appendChild(orderItemEl);
                });
            }

            // 更新總金額
            const total = currentOrder.reduce((sum, item) => sum + item.price, 0);
            totalAmountEl.textContent = total;
        }

        // 創建訂單項目元素
        function createOrderItemElement(item, index) {
            const orderItemEl = document.createElement('div');
            orderItemEl.className = 'order-item';

            // 組合甜度冰塊文字
            let optionsText = '';
            if (item.sugar && item.ice) {
                optionsText = `${item.sugar} / ${item.ice}`;
            } else if (item.sugar) {
                optionsText = item.sugar;
            } else if (item.ice) {
                optionsText = item.ice;
            }

            // 加料文字
            let toppingsText = '';
            if (item.toppings && item.toppings.length > 0) {
                const displayToppings = item.toppings.map(toppingName => {
                    const topping = toppings.find(t => t.name === toppingName);
                    return topping ? topping.displayName : toppingName;
                });
                toppingsText = `<div style="color: #667eea; font-size: 0.8rem;">加料: ${displayToppings.join(', ')}</div>`;
            }

            orderItemEl.innerHTML = `
                <div class="order-item-header">
                    <span>${item.beverage.name} (${item.size})</span>
                    <span class="price">$${item.price}</span>
                </div>
                <div class="order-item-details">
                    <span>${optionsText}</span>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="changeQuantity(${index}, -1)">−</button>
                        <span class="quantity-display">${item.quantity}</span>
                        <button class="quantity-btn" onclick="changeQuantity(${index}, 1)">+</button>
                    </div>
                </div>
                ${toppingsText}
            `;

            return orderItemEl;
        }

        // 改變數量
        function changeQuantity(index, change) {
            const item = currentOrder[index];
            item.quantity += change;

            if (item.quantity <= 0) {
                currentOrder.splice(index, 1);
            } else {
                // 重新計算價格
                const basePrice = item.beverage.prices[item.size];
                let toppingsPrice = 0;
                if (item.toppings) {
                    item.toppings.forEach(toppingName => {
                        const topping = toppings.find(t => t.name === toppingName);
                        if (topping) {
                            toppingsPrice += topping.price;
                        }
                    });
                }
                item.price = (basePrice + toppingsPrice) * item.quantity;
            }

            updateOrderDisplay();
            updateOrderPreview();
        }

        // 更新訂單預覽
        function updateOrderPreview() {
            const name = customerName.value.trim();
            const phone = customerPhone.value.trim();
            const address = deliveryAddress.value.trim();
            
            if (!name || !phone || !address || currentOrder.length === 0) {
                orderPreview.textContent = '請先填寫完整的訂購資訊和選擇飲品...';
                copyOrderBtn.disabled = true;
                sendOrderBtn.disabled = true;
                return;
            }

            const total = currentOrder.reduce((sum, item) => sum + item.price, 0);
            const orderTime = new Date().toLocaleString('zh-TW');

            let previewText = `🧋 功夫茶 KUNG FU TEA 訂單\n`;
            previewText += `==============================\n`;
            previewText += `📅 訂購時間：${orderTime}\n`;
            previewText += `👤 訂購人：${name}\n`;
            previewText += `📞 聯絡電話：${phone}\n`;
            previewText += `📍 外送地址：${address}\n`;
            previewText += `==============================\n`;
            previewText += `📋 訂購內容：\n\n`;

            currentOrder.forEach((item, index) => {
                let orderLine = `${index + 1}. ${item.beverage.name} ${item.size}`;
                
                // 添加甜度冰塊資訊
                if (item.ice && item.sugar) {
                    orderLine += ` ${item.ice}${item.sugar}`;
                } else if (item.ice) {
                    orderLine += ` ${item.ice}`;
                } else if (item.sugar) {
                    orderLine += ` ${item.sugar}`;
                }
                
                // 添加加料資訊
                if (item.toppings && item.toppings.length > 0) {
                    const displayToppings = item.toppings.map(toppingName => {
                        const topping = toppings.find(t => t.name === toppingName);
                        return topping ? topping.displayName : toppingName;
                    });
                    orderLine += ` +${displayToppings.join('+')}`;
                }
                
                orderLine += ` ×${item.quantity} 計：${item.price}`;
                previewText += orderLine + '\n';
            });

            previewText += `\n================\n`;
            previewText += `💰 總金額：${total}\n`;
            previewText += `================\n`;
            previewText += `\n謝謝您的訂購！🙏`;

            orderPreview.textContent = previewText;
            copyOrderBtn.disabled = false;
            sendOrderBtn.disabled = false;
        }

        // 複製訂單文字
        copyOrderBtn.onclick = async () => {
            try {
                await navigator.clipboard.writeText(orderPreview.textContent);
                copyOrderBtn.textContent = '✅ 已複製！';
                setTimeout(() => {
                    copyOrderBtn.textContent = '📋 複製訂單文字';
                }, 2000);
            } catch (err) {
                // 備用複製方法
                const textArea = document.createElement('textarea');
                textArea.value = orderPreview.textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                copyOrderBtn.textContent = '✅ 已複製！';
                setTimeout(() => {
                    copyOrderBtn.textContent = '📋 複製訂單文字';
                }, 2000);
            }
        };

        // 發送給店家
        sendOrderBtn.onclick = () => {
            const orderText = encodeURIComponent(orderPreview.textContent);
            const lineUrl = `https://lin.ee/QmyIa34?text=${orderText}`;
            window.open(lineUrl, '_blank');
        };

        // 儲存訂單
        saveOrderBtn.onclick = () => {
            if (currentOrder.length === 0) {
                alert('訂單是空的，無法儲存！');
                return;
            }

            const name = customerName.value.trim();
            const phone = customerPhone.value.trim();
            const address = deliveryAddress.value.trim();
            
            if (!name || !phone || !address) {
                alert('請先填寫完整的訂購資訊！');
                return;
            }

            const orderData = {
                id: Date.now(),
                name: name,
                phone: phone,
                address: address,
                items: [...currentOrder],
                total: currentOrder.reduce((sum, item) => sum + item.price, 0),
                saveTime: new Date().toLocaleString('zh-TW')
            };

            // 檢查是否超過10個訂單
            if (savedOrders.length >= 10) {
                if (confirm('已儲存10個訂單，是否要覆蓋最舊的訂單？')) {
                    savedOrders.shift(); // 移除最舊的訂單
                } else {
                    return;
                }
            }

            savedOrders.push(orderData);
            localStorage.setItem('kungfuTeaOrders', JSON.stringify(savedOrders));
            
            alert(`訂單已儲存！\n訂單編號: ${orderData.id}\n儲存時間: ${orderData.saveTime}`);
            updateLoadOrdersButton();
        };

        // 載入訂單列表
        loadOrdersBtn.onclick = () => {
            if (savedOrders.length === 0) {
                alert('沒有儲存的訂單！');
                return;
            }

            let ordersList = '儲存的訂單列表：\n\n';
            savedOrders.forEach((order, index) => {
                ordersList += `${index + 1}. 訂單編號: ${order.id}\n`;
                ordersList += `   訂購人: ${order.name}\n`;
                ordersList += `   電話: ${order.phone}\n`;
                ordersList += `   地址: ${order.address}\n`;
                ordersList += `   總金額: $${order.total}\n`;
                ordersList += `   儲存時間: ${order.saveTime}\n\n`;
            });

            const action = prompt(ordersList + '\n請輸入操作：\n1. 載入訂單 (輸入訂單編號)\n2. 刪除訂單 (輸入 d+訂單編號)\n3. 清空所有訂單 (輸入 clear)');

            if (action) {
                if (action.startsWith('d')) {
                    // 刪除訂單
                    const orderId = parseInt(action.substring(1));
                    const orderIndex = savedOrders.findIndex(order => order.id === orderId);
                    if (orderIndex !== -1) {
                        savedOrders.splice(orderIndex, 1);
                        localStorage.setItem('kungfuTeaOrders', JSON.stringify(savedOrders));
                        alert('訂單已刪除！');
                        updateLoadOrdersButton();
                    } else {
                        alert('找不到該訂單！');
                    }
                } else if (action === 'clear') {
                    // 清空所有訂單
                    if (confirm('確定要清空所有儲存的訂單嗎？')) {
                        savedOrders = [];
                        localStorage.setItem('kungfuTeaOrders', JSON.stringify(savedOrders));
                        alert('所有訂單已清空！');
                        updateLoadOrdersButton();
                    }
                } else {
                    // 載入訂單
                    const orderId = parseInt(action);
                    const order = savedOrders.find(order => order.id === orderId);
                    if (order) {
                        // 載入訂單資料
                        customerName.value = order.name;
                        customerPhone.value = order.phone;
                        deliveryAddress.value = order.address;
                        currentOrder = [...order.items];
                        updateOrderDisplay();
                        updateOrderPreview();
                        alert('訂單已載入！');
                    } else {
                        alert('找不到該訂單！');
                    }
                }
            }
        };

        // 更新載入訂單按鈕文字
        function updateLoadOrdersButton() {
            loadOrdersBtn.textContent = `📋 載入訂單 (${savedOrders.length}/10)`;
        }

        // 清空訂單
        clearOrderBtn.onclick = () => {
            if (currentOrder.length === 0) return;
            
            if (confirm('確定要清空所有訂單項目嗎？')) {
                currentOrder = [];
                updateOrderDisplay();
                updateOrderPreview();
            }
        };

        // 監聽訂購資訊輸入變化
        [customerName, customerPhone, deliveryAddress].forEach(input => {
            input.addEventListener('input', updateOrderPreview);
        });

        // 點擊模態框外部關閉
        window.onclick = (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };

        // 設置選項按鈕點擊事件
        document.addEventListener('DOMContentLoaded', () => {
            // 甜度選項
            document.querySelectorAll('#sugar-options .option-btn').forEach(btn => {
                btn.onclick = () => selectOption(btn, 'sugar');
            });

            // 冰塊選項
            document.querySelectorAll('#ice-options .option-btn').forEach(btn => {
                btn.onclick = () => selectOption(btn, 'ice');
            });
        });

        // 初始化應用
        initMenu();
        updateOrderDisplay();
        updateOrderPreview();
        updateLoadOrdersButton();
    </script>
</body>
</html>
