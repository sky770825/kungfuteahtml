<!DOCTYPE html>
<html lang="zh-TW">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>åŠŸå¤«èŒ¶ KUNG FU TEA - ç·šä¸Šé»é¤ v2.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        overflow-x: hidden;
        width: 100%;
        max-width: 100%;
      }

      /* åŠŸå¤«èŒ¶é»é¤ç³»çµ± - ç¾ä»£ç‰ˆå‹è¨­è¨ˆ */
      .kungfu-tea-ordering {
        --kt-primary: #2d5a27;
        --kt-primary-hover: #23491f;
        --kt-accent: #c17f59;
        --kt-accent-hover: #a86a47;
        --kt-text: #1a1a1a;
        --kt-text-muted: #5c5c5c;
        --kt-bg: #f7f5f2;
        --kt-surface: #ffffff;
        --kt-border: #e8e4df;
        --kt-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06);
        --kt-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        --kt-shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.1);
        --kt-radius: 14px;
        --kt-radius-lg: 20px;
        --kt-success: #2d7a3e;
        --kt-warning: #c94a21;
        --kt-font: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;

        all: initial;
        font-family: var(--kt-font) !important;
        font-size: 16px !important;
        line-height: 1.6 !important;
        background: var(--kt-bg) !important;
        min-height: 100vh !important;
        color: var(--kt-text) !important;
        display: block !important;
        margin: 0 !important;
        padding: 0 !important;
        box-sizing: border-box !important;
      }

      .kungfu-tea-ordering *,
      .kungfu-tea-ordering *::before,
      .kungfu-tea-ordering *::after {
        box-sizing: border-box !important;
      }

      .kungfu-tea-ordering .container {
        max-width: 1160px !important;
        margin: 0 auto !important;
        padding: 24px 20px !important;
        overflow-x: hidden !important;
        width: 100% !important;
      }

      .kungfu-tea-ordering header {
        background: var(--kt-surface) !important;
        border-radius: var(--kt-radius-lg) !important;
        padding: 32px 28px !important;
        text-align: center !important;
        margin-bottom: 28px !important;
        box-shadow: var(--kt-shadow) !important;
        border: 1px solid var(--kt-border) !important;
      }

      .kungfu-tea-ordering h1 {
        color: var(--kt-primary) !important;
        font-size: clamp(1.5rem, 4vw, 2.25rem) !important;
        font-weight: 700 !important;
        letter-spacing: 0.02em !important;
        margin-bottom: 8px !important;
        white-space: nowrap !important;
      }

      .kungfu-tea-ordering .subtitle {
        color: var(--kt-text-muted) !important;
        font-size: 0.9375rem !important;
        font-weight: 500 !important;
        margin-bottom: 20px !important;
      }

      .kungfu-tea-ordering .store-info {
        background: var(--kt-bg) !important;
        border-radius: var(--kt-radius) !important;
        padding: 16px 20px !important;
        margin-top: 12px !important;
        display: flex !important;
        flex-wrap: nowrap !important;
        justify-content: center !important;
        gap: 12px !important;
        font-size: 0.875rem !important;
        align-items: center !important;
        border: 1px solid var(--kt-border) !important;
      }

      .kungfu-tea-ordering .store-address {
        display: none !important;
      }

      .kungfu-tea-ordering .store-phone {
        color: var(--kt-text) !important;
        font-weight: 500 !important;
      }

      .kungfu-tea-ordering .phone-link {
        color: var(--kt-surface) !important;
        text-decoration: none !important;
        background: var(--kt-primary) !important;
        padding: 10px 18px !important;
        border-radius: 999px !important;
        font-weight: 600 !important;
        font-size: 0.9375rem !important;
        transition: background 0.2s ease, transform 0.2s ease !important;
        display: inline-block !important;
      }

      .kungfu-tea-ordering .phone-link:hover {
        background: var(--kt-primary-hover) !important;
        transform: translateY(-1px) !important;
      }

      .kungfu-tea-ordering .nav-link {
        color: var(--kt-surface) !important;
        text-decoration: none !important;
        background: var(--kt-primary) !important;
        padding: 10px 18px !important;
        border-radius: 999px !important;
        font-weight: 600 !important;
        font-size: 0.9375rem !important;
        transition: background 0.2s ease, transform 0.2s ease !important;
      }

      .kungfu-tea-ordering .nav-link:hover {
        background: var(--kt-primary-hover) !important;
        transform: translateY(-1px) !important;
      }

      .kungfu-tea-ordering .menu-link {
        color: var(--kt-surface) !important;
        text-decoration: none !important;
        background: var(--kt-accent) !important;
        padding: 10px 18px !important;
        border-radius: 999px !important;
        font-weight: 600 !important;
        font-size: 0.9375rem !important;
        transition: background 0.2s ease, transform 0.2s ease !important;
        display: inline-block !important;
        border: none !important;
        cursor: pointer !important;
      }

      .kungfu-tea-ordering .menu-link:hover {
        background: var(--kt-accent-hover) !important;
        transform: translateY(-1px) !important;
      }

      .kungfu-tea-ordering .delivery-icon {
        display: inline-block;
        width: 18px;
        height: 18px;
        border-radius: 4px;
        margin-right: 6px;
        font-size: 11px;
        text-align: center;
        line-height: 18px;
        vertical-align: middle;
      }

      .kungfu-tea-ordering .foodpanda-icon {
        background: linear-gradient(135deg, #ff6b9d, #ff8fab);
        color: white;
        font-size: 10px;
      }

      .kungfu-tea-ordering .ubereats-icon {
        background: linear-gradient(135deg, #06c167, #00a651);
        color: white;
        font-size: 10px;
      }

      .kungfu-tea-ordering .phone-icon {
        background: transparent;
        color: white;
        font-size: 10px;
      }

      .kungfu-tea-ordering .foodpanda-link { background: linear-gradient(135deg, #ff6b9d, #ff8fab) !important; }
      .kungfu-tea-ordering .foodpanda-link:hover { filter: brightness(1.05); transform: translateY(-1px); }
      .kungfu-tea-ordering .ubereats-link { background: linear-gradient(135deg, #06c167, #00a651) !important; }
      .kungfu-tea-ordering .ubereats-link:hover { filter: brightness(1.05); transform: translateY(-1px); }
      .kungfu-tea-ordering .yovvip-link { background: linear-gradient(135deg, #e85d04, #f48c06) !important; }
      .kungfu-tea-ordering .yovvip-link:hover { filter: brightness(1.05); transform: translateY(-1px); }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 24px;
      }

      .order-section {
        grid-column: 2;
        grid-row: 1;
      }

      .section {
        background: var(--kt-surface);
        border-radius: var(--kt-radius-lg);
        padding: 28px 24px;
        box-shadow: var(--kt-shadow);
        height: fit-content;
        border: 1px solid var(--kt-border);
      }

      .section-title {
        color: var(--kt-primary);
        font-size: clamp(1.2rem, 2.5vw, 1.5rem);
        font-weight: 700;
        margin-bottom: 20px;
        text-align: center;
        padding-bottom: 12px;
        border-bottom: 3px solid var(--kt-primary);
        letter-spacing: 0.02em;
      }

      .category-dropdown {
        margin-bottom: 14px;
      }

      .category-header {
        background: var(--kt-primary);
        color: white;
        padding: 14px 20px;
        border-radius: var(--kt-radius);
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .category-header:hover {
        background: var(--kt-primary-hover);
        transform: translateY(-1px);
      }

      .category-content {
        display: none;
        padding: 16px 0 0 4px;
        border-left: 4px solid var(--kt-primary);
        margin-left: 8px;
        padding-left: 16px;
      }

      .category-content.active {
        display: block;
      }

      .dropdown-arrow {
        transition: transform 0.25s ease;
      }

      .dropdown-arrow.rotated {
        transform: rotate(180deg);
      }

      .beverage-item {
        background: var(--kt-bg);
        border: 1px solid var(--kt-border);
        border-radius: var(--kt-radius);
        padding: 16px 18px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }

      .beverage-item:hover {
        border-color: var(--kt-primary);
        box-shadow: var(--kt-shadow-sm);
        transform: translateY(-1px);
      }

      .beverage-name {
        font-weight: 600;
        font-size: 1rem;
        color: var(--kt-text);
        margin-bottom: 6px;
      }

      .beverage-name-price {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
      }

      .beverage-name-text {
        flex: 1;
        font-size: 1rem;
      }

      .beverage-price-text {
        color: var(--kt-primary);
        font-weight: 700;
        font-size: 1rem;
        margin-left: 12px;
      }

      .beverage-prices {
        color: var(--kt-primary);
        font-weight: 700;
        font-size: 0.9375rem;
        margin-bottom: 4px;
      }

      .beverage-notes {
        color: var(--kt-text-muted);
        font-size: 0.8125rem;
        line-height: 1.45;
      }

      /* ç‰¹æ®Šå‚™è¨»é¡è‰² */
      .beverage-notes.recommended {
        color: #e74c3c !important;
        font-weight: 600 !important;
        background: rgba(231, 76, 60, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(231, 76, 60, 0.3) !important;
      }

      .beverage-notes.no-toppings {
        color: #f39c12 !important;
        font-weight: 600 !important;
        background: rgba(243, 156, 18, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(243, 156, 18, 0.3) !important;
      }

      .beverage-notes.no-sugar {
        color: #27ae60 !important;
        font-weight: 600 !important;
        background: rgba(39, 174, 96, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(39, 174, 96, 0.3) !important;
      }

      .beverage-notes.fixed-options {
        color: #8e44ad !important;
        font-weight: 600 !important;
        background: rgba(142, 68, 173, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(142, 68, 173, 0.3) !important;
      }

      .beverage-notes.ice-limit {
        color: #3498db !important;
        font-weight: 600 !important;
        background: rgba(52, 152, 219, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(52, 152, 219, 0.3) !important;
      }

      .beverage-notes.included-toppings {
        color: #e67e22 !important;
        font-weight: 600 !important;
        background: rgba(230, 126, 34, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(230, 126, 34, 0.3) !important;
      }

      .beverage-notes.no-caffeine {
        color: #9b59b6 !important;
        font-weight: 600 !important;
        background: rgba(155, 89, 182, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(155, 89, 182, 0.3) !important;
      }

      .beverage-notes.no-tea {
        color: #3498db !important;
        font-weight: 600 !important;
        background: rgba(52, 152, 219, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(52, 152, 219, 0.3) !important;
      }

      .beverage-notes.smoothie {
        color: #e91e63 !important;
        font-weight: 600 !important;
        background: rgba(233, 30, 99, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(233, 30, 99, 0.3) !important;
      }

      .beverage-notes.limited {
        color: #d32f2f !important;
        font-weight: 600 !important;
        background: rgba(211, 47, 47, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(211, 47, 47, 0.3) !important;
      }

      .beverage-notes.no-hot {
        color: #607d8b !important;
        font-weight: 600 !important;
        background: rgba(96, 125, 139, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(96, 125, 139, 0.3) !important;
      }

      .beverage-notes.golden-ratio {
        color: #ff9800 !important;
        font-weight: 600 !important;
        background: rgba(255, 152, 0, 0.1) !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        display: inline-block !important;
        border: 1px solid rgba(255, 152, 0, 0.3) !important;
      }

      .star {
        color: #ffd700;
        font-weight: bold;
      }

      /* è¨‚å–®å€åŸŸæ¨£å¼ */
      .customer-info {
        margin-bottom: 20px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }

      .customer-info .info-group {
        margin-bottom: 0;
      }

      .customer-info .info-group:has(#delivery-address),
      .customer-info .info-group:has(#delivery-time) {
        grid-column: 1 / -1;
      }

      .info-group {
        margin-bottom: 15px;
      }

      .info-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        font-size: 0.9375rem;
        color: var(--kt-text);
      }

      .info-group input {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid var(--kt-border);
        border-radius: var(--kt-radius);
        font-size: 1rem;
        font-family: var(--kt-font);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }

      .info-group input:focus {
        outline: none;
        border-color: var(--kt-primary);
        box-shadow: 0 0 0 3px rgba(45, 90, 39, 0.12);
      }

      .distance-info {
        background: rgba(45, 90, 39, 0.06);
        border: 1px solid var(--kt-primary);
        border-radius: var(--kt-radius);
        padding: 16px;
        margin-top: 10px;
        box-shadow: var(--kt-shadow-sm);
        animation: slideIn 0.3s ease;
      }

      .distance-display,
      .delivery-level,
      .free-shipping-info {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 0.95rem;
        font-weight: 500;
      }

      .distance-display:last-child,
      .delivery-level:last-child,
      .free-shipping-info:last-child {
        margin-bottom: 0;
      }

      .distance-icon,
      .level-icon,
      .free-icon {
        margin-right: 8px;
        font-size: 1.1rem;
      }

      /* å…é‹æé†’æ¨£å¼ */
      .shipping-reminder {
        animation: slideIn 0.3s ease;
      }

      .shipping-reminder-content {
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .shipping-reminder-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
        padding: 6px 0;
      }

      .shipping-reminder-item:last-child {
        margin-bottom: 0;
      }

      .shipping-reminder-icon {
        margin-right: 8px;
        font-size: 1rem;
        min-width: 20px;
      }

      .shipping-reminder-text {
        flex: 1;
        font-weight: 500;
      }

      .shipping-reminder-amount {
        font-weight: bold;
        color: #e74c3c;
      }

      .shipping-reminder-amount.achieved {
        color: #27ae60;
      }

      .shipping-reminder-fee {
        font-weight: bold;
        color: #f39c12;
      }

      .distance-text,
      .level-text,
      .free-text {
        color: var(--kt-text);
      }

      .distance-value,
      .level-value,
      .free-shipping-value {
        color: var(--kt-primary);
        font-weight: 700;
        font-size: 1.0625rem;
      }

      /* ä¸åŒç´šåˆ¥çš„é¡è‰² */
      .level-low {
        color: #27ae60;
      }

      .level-medium {
        color: #f39c12;
      }

      .level-high {
        color: #e74c3c;
      }

      .level-max {
        color: #8e44ad;
      }

      .order-item {
        background: var(--kt-bg);
        border-radius: var(--kt-radius);
        padding: 16px 18px;
        margin-bottom: 10px;
        border-left: 4px solid var(--kt-primary);
        border: 1px solid var(--kt-border);
        border-left: 4px solid var(--kt-primary);
      }

      .order-item-header {
        font-weight: 600;
        font-size: 1rem;
        color: var(--kt-text);
        margin-bottom: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .order-item-name {
        flex: 1;
      }

      .order-item-price {
        color: var(--kt-primary);
        font-weight: 700;
        margin-left: 12px;
      }

      .order-item-details {
        color: var(--kt-text-muted);
        font-size: 0.9375rem;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .order-item-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
      }

      .quantity-controls {
        display: flex;
        align-items: center;
        gap: 4px;
        background: var(--kt-bg);
        border-radius: 999px;
        padding: 3px;
        border: 1px solid var(--kt-border);
      }

      .quantity-btn {
        background: var(--kt-primary);
        color: white;
        border: none;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9375rem;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .quantity-btn:hover {
        background: var(--kt-primary-hover);
        transform: scale(1.08);
      }

      .quantity-display {
        background: var(--kt-surface);
        color: var(--kt-primary);
        border-radius: 8px;
        padding: 4px 10px;
        font-weight: 700;
        font-size: 0.9375rem;
        min-width: 24px;
        text-align: center;
      }

      .total-section {
        border-top: 2px solid var(--kt-border);
        padding-top: 18px;
        margin-top: 18px;
        text-align: center;
      }

      .total-amount {
        font-size: clamp(1.2rem, 3vw, 1.5rem);
        font-weight: 700;
        color: var(--kt-primary);
        margin-bottom: 16px;
      }

      .preview-area {
        background: var(--kt-bg);
        border: 1px solid var(--kt-border);
        border-radius: var(--kt-radius);
        padding: 18px;
        margin-bottom: 16px;
        min-height: 200px;
        font-family: 'Noto Sans TC', ui-monospace, monospace;
        font-size: 0.9375rem;
        line-height: 1.55;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .copy-btn {
        background: var(--kt-primary);
        color: white;
        border: none;
        border-radius: var(--kt-radius);
        padding: 14px 20px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        width: 100%;
        margin-bottom: 10px;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .copy-btn:hover {
        background: var(--kt-primary-hover);
        transform: translateY(-1px);
      }

      .btn {
        padding: 14px 20px;
        border: none;
        border-radius: var(--kt-radius);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        width: 100%;
        margin-bottom: 10px;
        transition: transform 0.2s ease, background 0.2s ease;
        font-family: var(--kt-font);
      }

      .btn-primary {
        background: var(--kt-success);
        color: white;
        font-size: 1.0625rem;
      }

      .btn-primary:hover:not(:disabled) {
        filter: brightness(1.08);
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: var(--kt-surface);
        color: var(--kt-text-muted);
        border: 1px solid var(--kt-border);
      }

      .btn-secondary:hover {
        background: var(--kt-bg);
        border-color: var(--kt-primary);
        color: var(--kt-primary);
        transform: translateY(-1px);
      }

      .btn:disabled {
        background: #c9c9c9;
        color: #888;
        cursor: not-allowed;
        transform: none;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.45);
        backdrop-filter: blur(4px);
      }

      /* å¯æ„›æé†’æ¡†æ¨£å¼ */
      .cute-alert {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        animation: fadeIn 0.3s ease;
      }

      .cute-alert-content {
        background: var(--kt-surface);
        margin: 15% auto;
        padding: 0;
        border-radius: var(--kt-radius-lg);
        width: 90%;
        max-width: 400px;
        text-align: center;
        box-shadow: var(--kt-shadow-lg);
        animation: slideIn 0.4s ease;
        border: 1px solid var(--kt-border);
        overflow: hidden;
      }

      .cute-alert-header {
        background: var(--kt-primary);
        padding: 20px;
        color: white;
        position: relative;
      }

      .cute-alert-icon {
        font-size: 3rem;
        margin-bottom: 10px;
        animation: bounce 2s infinite;
      }

      .cute-alert-title {
        font-size: 1.3rem;
        font-weight: bold;
        margin: 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .cute-alert-body {
        padding: 25px 20px;
        color: var(--kt-text);
        font-size: 1rem;
        line-height: 1.6;
      }

      .cute-alert-message {
        margin-bottom: 20px;
        font-weight: 500;
      }

      .cute-alert-details {
        background: rgba(255, 255, 255, 0.7);
        padding: 15px;
        border-radius: 15px;
        margin: 15px 0;
        border: 2px solid rgba(102, 126, 234, 0.2);
      }

      .cute-alert-button {
        background: var(--kt-primary);
        color: white;
        border: none;
        border-radius: 999px;
        padding: 12px 28px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.2s ease;
        margin: 10px;
      }

      .cute-alert-button:hover {
        background: var(--kt-primary-hover);
        transform: translateY(-1px);
      }

      .cute-alert-button:active {
        transform: translateY(0);
      }

      /* å‹•ç•«æ•ˆæœ */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          transform: translateY(-50px) scale(0.8);
          opacity: 0;
        }

        to {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      @keyframes bounce {

        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }

        40% {
          transform: translateY(-10px);
        }

        60% {
          transform: translateY(-5px);
        }
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }

        50% {
          transform: scale(1.05);
        }

        100% {
          transform: scale(1);
        }
      }

      .cute-alert-content:hover {
        animation: pulse 0.6s ease;
      }

      /* æ‰‹æ©Ÿç‰ˆå¯æ„›æé†’æ¡†æ¨£å¼ */
      @media (max-width: 768px) {
        .cute-alert-content {
          margin: 10% auto;
          width: 95%;
          max-width: 350px;
        }

        .cute-alert-header {
          padding: 15px;
        }

        .cute-alert-icon {
          font-size: 2.5rem;
          margin-bottom: 8px;
        }

        .cute-alert-title {
          font-size: 1.1rem;
        }

        .cute-alert-body {
          padding: 20px 15px;
          font-size: 0.9rem;
        }

        .cute-alert-message {
          margin-bottom: 15px;
          font-size: 0.9rem;
        }

        .cute-alert-details {
          padding: 12px;
          margin: 12px 0;
          font-size: 0.85rem;
        }

        .cute-alert-button {
          padding: 10px 25px;
          font-size: 0.9rem;
          margin: 8px;
        }
      }

      @media (max-width: 480px) {
        .cute-alert-content {
          margin: 5% auto;
          width: 98%;
          max-width: 320px;
        }

        .cute-alert-header {
          padding: 12px;
        }

        .cute-alert-icon {
          font-size: 2rem;
          margin-bottom: 6px;
        }

        .cute-alert-title {
          font-size: 1rem;
        }

        .cute-alert-body {
          padding: 15px 12px;
          font-size: 0.85rem;
        }

        .cute-alert-message {
          margin-bottom: 12px;
          font-size: 0.85rem;
        }

        .cute-alert-details {
          padding: 10px;
          margin: 10px 0;
          font-size: 0.8rem;
        }

        .cute-alert-button {
          padding: 8px 20px;
          font-size: 0.85rem;
          margin: 6px;
        }
      }

      .modal-content {
        background: var(--kt-surface);
        margin: 5% auto;
        padding: 28px 24px;
        border-radius: var(--kt-radius-lg);
        width: 90%;
        max-width: 480px;
        text-align: center;
        box-shadow: var(--kt-shadow-lg);
        border: 1px solid var(--kt-border);
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-title {
        color: var(--kt-primary);
        font-size: clamp(1.25rem, 3vw, 1.5rem);
        font-weight: 700;
        margin-bottom: 20px;
      }

      .option-group {
        margin: 20px 0;
        text-align: left;
      }

      .option-group label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        font-size: 0.9375rem;
        color: var(--kt-text);
      }

      .option-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .option-btn {
        background: var(--kt-bg);
        border: 1px solid var(--kt-border);
        border-radius: var(--kt-radius);
        padding: 10px 16px;
        cursor: pointer;
        font-size: 0.9375rem;
        font-weight: 500;
        color: var(--kt-text);
        transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .option-btn:hover,
      .option-btn.selected {
        background: var(--kt-primary);
        border-color: var(--kt-primary);
        color: white;
      }

      .quantity-input {
        margin: 20px 0;
      }

      .quantity-input label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 0.9375rem;
        color: var(--kt-text);
      }

      .quantity-stepper {
        display: inline-flex;
        align-items: center;
        gap: 0;
        border: 1px solid var(--kt-border);
        border-radius: var(--kt-radius);
        overflow: hidden;
        background: var(--kt-bg);
      }

      .quantity-stepper-btn {
        width: 44px;
        height: 44px;
        min-width: 44px;
        min-height: 44px;
        border: none;
        background: var(--kt-primary);
        color: white;
        font-size: 1.25rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        transition: background 0.2s ease;
      }

      .quantity-stepper-btn:hover {
        background: var(--kt-primary-hover);
      }

      .quantity-stepper-btn:active {
        opacity: 0.9;
      }

      .quantity-input input {
        border: none;
        border-left: 1px solid var(--kt-border);
        border-right: 1px solid var(--kt-border);
        padding: 12px 8px;
        font-size: 1.125rem;
        text-align: center;
        width: 56px;
        min-width: 48px;
        background: var(--kt-surface);
        -moz-appearance: textfield;
      }

      .quantity-input input::-webkit-outer-spin-button,
      .quantity-input input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      .modal-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 25px;
      }

      .empty-order {
        text-align: center;
        color: var(--kt-text-muted);
        font-size: 0.9375rem;
        margin: 24px 0;
      }

      .order-controls {
        display: flex;
        gap: 10px;
        margin: 15px 0;
        flex-wrap: wrap;
      }

      .order-controls .btn {
        flex: 1;
        min-width: 120px;
      }

      @media (max-width: 1024px) {
        .main-content {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .kungfu-tea-ordering .container {
          padding: 16px 14px;
        }

        .kungfu-tea-ordering h1 {
          font-size: 1.5rem !important;
        }

        .kungfu-tea-ordering .subtitle {
          font-size: 0.875rem !important;
        }

        /* é›»è…¦ç‰ˆå¤–é€æŸ¥è©¢è¡¨å„ªåŒ– */
        #delivery-fee-table {
          font-size: 0.65rem !important;
          max-width: 800px !important;
          margin: 0 auto !important;
        }

        #delivery-fee-table th,
        #delivery-fee-table td {
          padding: 4px 3px !important;
          white-space: nowrap !important;
        }

        /* é›»è…¦ç‰ˆè¡¨æ ¼å®¹å™¨å„ªåŒ– */
        @media (min-width: 769px) {
          #delivery-fee-content {
            max-width: 900px !important;
            margin: 0 auto !important;
          }

          #delivery-fee-content .overflow-x-auto {
            display: flex;
            justify-content: center;
          }
        }

        /* æ‰‹æ©Ÿç‰ˆå¤–é€æŸ¥è©¢è¡¨å„ªåŒ– */
        @media (max-width: 768px) {
          #delivery-fee-table {
            font-size: 0.7rem !important;
          }

          #delivery-fee-table th,
          #delivery-fee-table td {
            padding: 4px 2px !important;
            white-space: nowrap !important;
          }

          /* æ‰‹æ©Ÿç‰ˆæ¨™é¡Œå€åŸŸå„ªåŒ– */
          .section-title {
            font-size: 1.1rem !important;
            white-space: nowrap !important;
            flex: 1 !important;
            min-width: 0 !important;
          }

          /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•å€åŸŸå„ªåŒ– */
          #toggle-delivery-fee {
            font-size: 0.8rem !important;
            padding: 6px 10px !important;
            white-space: nowrap !important;
            flex-shrink: 0 !important;
          }
        }

        #delivery-fee-content {
          margin-top: 10px !important;
        }

        #delivery-fee-content h3 {
          font-size: 1rem !important;
          margin-bottom: 8px !important;
        }

        #delivery-fee-content .section {
          padding: 10px !important;
        }

        /* æ‰‹æ©Ÿç‰ˆå¡ç‰‡å¼é¡¯ç¤ºå„ªåŒ– */
        #delivery-fee-tbody .option-btn {
          font-size: 0.7rem !important;
          padding: 6px 8px !important;
        }

        #delivery-fee-tbody div[style*="grid-template-columns"] {
          font-size: 0.7rem !important;
          padding: 8px !important;
        }

        .kungfu-tea-ordering .store-info {
          flex-direction: row !important;
          gap: 10px !important;
          text-align: center !important;
          font-size: 0.8rem !important;
          flex-wrap: nowrap !important;
          justify-content: center !important;
          overflow-x: auto !important;
        }

        .kungfu-tea-ordering .store-address {
          display: none !important;
        }

        .kungfu-tea-ordering h1 {
          font-size: 1.375rem !important;
        }

        .kungfu-tea-ordering .nav-link {
          display: inline-block !important;
          margin-top: 5px !important;
          padding: 8px 10px !important;
          font-size: 0.8rem !important;
        }

        .kungfu-tea-ordering .phone-link {
          padding: 8px 10px !important;
          font-size: 0.8rem !important;
        }

        /* æ‰‹æ©Ÿç‰ˆè¯çµ¡æ–¹å¼å€åŸŸå„ªåŒ– */
        .contact-links-container {
          flex-direction: column !important;
          gap: 10px !important;
        }

        .contact-links-container .phone-link,
        .contact-links-container .nav-link {
          width: 100% !important;
          text-align: center !important;
          padding: 12px 15px !important;
          font-size: 0.9rem !important;
        }

        /* æ‰‹æ©Ÿç‰ˆèœå–®åœ–ç‰‡å„ªåŒ– */
        #menu-modal .modal-content img {
          max-width: 95% !important;
          max-height: 60vh !important;
        }

        /* æ‰‹æ©Ÿç‰ˆï¼šå¸Œæœ›é€é”æ™‚é–“ç¶­æŒæ©«å‘ä¸¦æ’ï¼ˆæ™‚é–“ï¼‹æ•´/å‰ åŒä¸€è¡Œï¼‰ */
        .info-group .delivery-time-row {
          flex-direction: row !important;
          flex-wrap: nowrap !important;
          gap: 10px !important;
        }

        .info-group input[type="time"],
        .info-group select {
          font-size: 1rem !important;
          padding: 12px !important;
        }

        /* æ‰‹æ©Ÿç‰ˆè¨‚è³¼è³‡è¨Šæ”¹ç‚ºå–®æ¬„ */
        .customer-info {
          grid-template-columns: 1fr;
        }

        .customer-info .info-group:has(#delivery-address),
        .customer-info .info-group:has(#delivery-time) {
          grid-column: 1;
        }

        .kungfu-tea-ordering .delivery-icon {
          width: 14px;
          height: 14px;
          font-size: 9px;
          line-height: 14px;
          margin-right: 4px;
        }

        .main-content {
          display: flex;
          flex-direction: column;
        }

        /* æ‰‹æ©Ÿç‰ˆï¼šèœå–®å€åŸŸåœ¨ç¬¬ä¸€å€‹ */
        .main-content .section:nth-child(1) {
          order: 1;
        }

        /* æ‰‹æ©Ÿç‰ˆï¼šè¨‚å–®å€åŸŸåœ¨ç¬¬äºŒå€‹ */
        .main-content .order-section {
          order: 2;
        }

        /* æ‰‹æ©Ÿç‰ˆï¼šè¨‚å–®é è¦½åœ¨ç¬¬ä¸‰å€‹ */
        .main-content .section:nth-child(3) {
          order: 3;
        }

        .section {
          padding: 15px;
          margin-bottom: 15px;
        }

        .section-title {
          font-size: 1.25rem !important;
          margin-bottom: 16px;
        }

        .category-header {
          padding: 12px 16px;
          font-size: 0.9375rem;
        }

        .beverage-item {
          padding: 14px 16px;
          margin-bottom: 8px;
        }

        .beverage-name-price {
          font-size: 1rem;
        }

        .beverage-name-text {
          font-size: 0.9375rem;
        }

        .beverage-price-text {
          font-size: 0.9375rem;
        }


        .beverage-notes {
          font-size: 0.85rem;
        }

        .info-group input {
          padding: 12px;
          font-size: 1rem;
        }

        .order-item {
          padding: 12px;
        }

        .quantity-btn {
          width: 32px;
          height: 32px;
          font-size: 1rem;
        }

        .quantity-controls {
          gap: 2px;
          padding: 1px;
        }

        .quantity-display {
          font-size: 0.8rem;
          padding: 1px 6px;
        }

        .order-item-header {
          flex-direction: row;
          align-items: center;
          gap: 5px;
        }

        .order-item-details {
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
          gap: 8px;
        }

        .order-item-details .quantity-controls {
          flex-shrink: 0;
        }

        .modal-content {
          margin: 4% auto;
          padding: 20px 16px;
          width: 94%;
          max-width: 420px;
          max-height: 88vh;
        }

        /* æ‰‹æ©Ÿç‰ˆï¼šè¨‚å–®å½ˆçª—æ•´é«”æŒ‰éˆ•å€æ›´ç·Šæ¹Š */
        #order-modal .modal-content {
          padding: 14px 12px;
          max-height: 90vh;
        }

        #order-modal .modal-title {
          font-size: 1.2rem;
          margin-bottom: 12px;
        }

        #order-modal .option-group {
          margin: 10px 0;
        }

        #order-modal .option-group label {
          margin-bottom: 6px;
          font-size: 0.875rem;
        }

        #order-modal .option-buttons {
          gap: 6px;
        }

        #order-modal .option-btn {
          padding: 8px 10px;
          font-size: 0.85rem;
          min-height: 40px;
        }

        #order-modal .quantity-input {
          margin: 12px 0;
        }

        #order-modal .quantity-input label {
          margin-bottom: 6px;
          font-size: 0.875rem;
        }

        #order-modal .quantity-stepper-btn {
          width: 44px;
          height: 44px;
          min-width: 44px;
          min-height: 44px;
          font-size: 1.25rem;
        }

        #order-modal .quantity-input input {
          width: 52px;
          padding: 10px 6px;
          font-size: 1.1rem;
        }

        #order-modal .modal-buttons {
          margin-top: 14px;
          gap: 8px;
        }

        #order-modal .modal-buttons .btn {
          padding: 12px 14px;
          font-size: 0.95rem;
        }

        .modal-title {
          font-size: 1.3rem;
        }

        .option-buttons {
          gap: 8px;
        }

        .option-btn {
          padding: 12px 14px;
          font-size: 0.9rem;
          min-height: 44px;
        }

        .quantity-stepper-btn {
          width: 48px;
          height: 48px;
          min-width: 48px;
          min-height: 48px;
          font-size: 1.4rem;
        }

        .quantity-input input {
          width: 60px;
          padding: 14px 8px;
          font-size: 1.2rem;
        }

        .modal-buttons {
          flex-direction: column;
          gap: 10px;
        }

        .btn {
          padding: 15px;
          font-size: 1rem;
        }

        .preview-area {
          font-size: 0.8rem;
          min-height: 150px;
          padding: 12px;
        }

        .order-controls {
          flex-direction: column;
          gap: 8px;
        }

        .order-controls .btn {
          min-width: auto;
        }

        .copy-btn {
          font-size: 1rem;
          padding: 15px;
        }

        .btn-primary {
          font-size: 1rem;
          padding: 15px;
        }

        /* è·é›¢è¨ˆç®—çµæœå¹³æ¿ç‰ˆå„ªåŒ– */
        .distance-info {
          padding: 12px;
          margin-top: 8px;
        }

        .distance-display,
        .delivery-level,
        .free-shipping-info {
          font-size: 0.9rem;
          margin-bottom: 6px;
        }

        .distance-icon,
        .level-icon,
        .free-icon {
          font-size: 1rem;
          margin-right: 6px;
        }

        /* å…é‹æé†’å¹³æ¿ç‰ˆæ¨£å¼ */
        .shipping-reminder {
          padding: 10px;
          margin-top: 10px;
        }

        .shipping-reminder-content {
          font-size: 0.85rem;
        }

        .shipping-reminder-item {
          margin-bottom: 5px;
          padding: 5px 0;
        }

        .shipping-reminder-icon {
          font-size: 0.9rem;
          margin-right: 6px;
          min-width: 18px;
        }

        .distance-value,
        .level-value,
        .free-shipping-value {
          font-size: 1rem;
        }
      }

      @media (max-width: 480px) {
        .kungfu-tea-ordering .container {
          padding: 12px 10px;
        }

        .kungfu-tea-ordering h1 {
          font-size: 1.25rem !important;
        }

        .kungfu-tea-ordering .subtitle {
          font-size: 0.8125rem !important;
        }

        .section {
          padding: 18px 16px;
        }

        .beverage-item {
          padding: 12px 14px;
        }

        .category-header {
          padding: 12px 14px;
          font-size: 0.875rem;
        }

        #order-modal .modal-content {
          margin: 2% auto;
          padding: 12px 10px;
          width: 96%;
          max-width: 380px;
          max-height: 92vh;
        }

        #order-modal .modal-title {
          margin-bottom: 10px;
          font-size: 1.1rem;
        }

        #order-modal .option-group {
          margin: 8px 0;
        }

        #order-modal .option-group label {
          margin-bottom: 4px;
          font-size: 0.8125rem;
        }

        #order-modal .option-buttons {
          gap: 5px;
        }

        #order-modal .option-btn {
          padding: 6px 8px;
          font-size: 0.8125rem;
          min-height: 38px;
        }

        #order-modal .quantity-input {
          margin: 10px 0;
        }

        #order-modal .quantity-stepper-btn {
          width: 42px;
          height: 42px;
          min-width: 42px;
          min-height: 42px;
          font-size: 1.2rem;
        }

        #order-modal .quantity-input input {
          width: 48px;
          padding: 8px 4px;
          font-size: 1rem;
        }

        #order-modal .modal-buttons {
          margin-top: 10px;
          gap: 6px;
        }

        #order-modal .modal-buttons .btn {
          padding: 10px 12px;
          font-size: 0.9rem;
        }

        .option-buttons {
          grid-template-columns: 1fr 1fr;
        }

        .option-btn {
          padding: 10px 12px;
          font-size: 0.85rem;
          min-height: 44px;
        }

        .quantity-stepper-btn {
          width: 52px;
          height: 52px;
          min-width: 52px;
          min-height: 52px;
          font-size: 1.5rem;
        }

        .quantity-input input {
          width: 56px;
          padding: 14px 6px;
          font-size: 1.25rem;
        }

        /* è¶…å°è¢å¹•å¤–é€æŸ¥è©¢è¡¨å„ªåŒ– */
        @media (max-width: 480px) {
          #delivery-fee-table {
            font-size: 0.7rem !important;
          }

          #delivery-fee-table th,
          #delivery-fee-table td {
            padding: 4px 2px !important;
          }
        }

        #delivery-fee-content h3 {
          font-size: 1rem !important;
        }

        #delivery-fee-tbody div[style*="grid-template-columns"] {
          font-size: 0.7rem !important;
          padding: 8px !important;
          gap: 4px !important;
        }

        /* è·é›¢è¨ˆç®—çµæœæ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .distance-info {
          padding: 10px;
          margin-top: 6px;
          border-radius: 8px;
        }

        .distance-display,
        .delivery-level,
        .free-shipping-info {
          font-size: 0.85rem;
          margin-bottom: 6px;
        }

        .distance-icon,
        .level-icon,
        .free-icon {
          font-size: 0.9rem;
          margin-right: 6px;
        }

        /* å…é‹æé†’æ‰‹æ©Ÿç‰ˆæ¨£å¼ */
        .shipping-reminder {
          padding: 8px;
          margin-top: 8px;
        }

        .shipping-reminder-content {
          font-size: 0.8rem;
        }

        .shipping-reminder-item {
          margin-bottom: 4px;
          padding: 4px 0;
        }

        .shipping-reminder-icon {
          font-size: 0.85rem;
          margin-right: 5px;
          min-width: 16px;
        }

        .shipping-reminder-text {
          font-size: 0.8rem;
        }

        .shipping-reminder-amount,
        .shipping-reminder-fee {
          font-size: 0.8rem;
        }

        .distance-value,
        .level-value,
        .free-shipping-value {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="kungfu-tea-ordering">
      <div class="container">
        <header>
          <h1>åŠŸå¤«èŒ¶ KUNG FU TEA</h1>
          <div class="subtitle">é»é¤æ–‡å­—ç”Ÿæˆå™¨ | è£½ä½œäººï¼šæ¥Šæ¢…å››ç¶­åº—-è”¡åº—é•·</div>
          <div class="store-info">
            <div class="store-address">
              ğŸ“ æ¥Šæ¢…å€å››ç¶­è·¯90è™Ÿ
            </div>
            <div class="store-navigation">
              <a href="https://foodpanda.go.link/34CwH"
                 target="_blank"
                 class="nav-link delivery-link foodpanda-link">
                <span class="delivery-icon foodpanda-icon">ğŸ¼</span>foodpanda
              </a>
              <a href="https://www.ubereats.com/tw/store/%E5%8A%9F%E5%A4%AB%E8%8C%B6-kungfutea-%E6%A5%8A%E6%A2%85%E5%9B%9B%E7%B6%AD%E5%BA%97/zo2ii2cgUcCaK5-5O96-Fw?diningMode=DELIVERY&ps=1&sc=SEARCH_SUGGESTION"
                 target="_blank"
                 class="nav-link delivery-link ubereats-link"
                 style="margin-left: 10px;">
                <span class="delivery-icon ubereats-icon">ğŸ½ï¸</span>Uber Eats
              </a>
              <a href="https://www.yovvip.com/ORD/Order?store=MTMyXzQyNA%3D%3D&appbar=f"
                 target="_blank"
                 class="nav-link delivery-link yovvip-link"
                 style="margin-left: 10px;">
                <span class="delivery-icon yovvip-icon">ğŸ´</span>äº«ä»€éº¼ç·šä¸Šé»é¤
              </a>
              <button class="nav-link menu-link"
                      id="view-menu-btn"
                      style="margin-left: 10px;">
                ğŸ“‹ æŸ¥çœ‹å®Œæ•´èœå–®
              </button>
            </div>
          </div>
        </header>

        <div class="main-content">
          <!-- èœå–®å€åŸŸ -->
          <div class="section">
            <h2 class="section-title">èœå–®</h2>
            <div id="menu-container"></div>
          </div>

          <!-- è¨‚å–®èˆ‡è¨‚è³¼è³‡è¨Šåˆä½µå€åŸŸ -->
          <div class="section order-section">
            <h2 class="section-title">æ‚¨çš„è¨‚å–®</h2>
            <div id="order-container">
              <div class="empty-order">å°šæœªé¸æ“‡ä»»ä½•é£²å“</div>
            </div>

            <div class="total-section">
              <div class="total-amount">ç¸½è¨ˆ: $<span id="total-amount">0</span></div>
            </div>

            <h3 class="section-title" style="font-size: 1.2rem; margin: 24px 0 16px 0; border-top: 2px solid var(--kt-border); padding-top: 18px;">è¨‚è³¼è³‡è¨Š</h3>
            <div class="customer-info">
              <div class="info-group">
                <label for="customer-name">è¨‚è³¼äººå§“å</label>
                <input type="text"
                       id="customer-name"
                       placeholder="è«‹è¼¸å…¥å§“å">
              </div>
              <div class="info-group">
                <label for="customer-phone">è¯çµ¡é›»è©±</label>
                <input type="tel"
                       id="customer-phone"
                       placeholder="è¯çµ¡é›»è©±orå…¬å¸é›»è©±#åˆ†æ©Ÿ">
              </div>
              <div class="info-group">
                <label for="delivery-address">å¤–é€åœ°å€</label>
                <input type="text"
                       id="delivery-address"
                       placeholder="å¤–é€åœ°å€+(å…¬å¸è¡Œè™Ÿ)"
                       value="æ¥Šæ¢…å€">

                <!-- è·é›¢è¨ˆç®—çµæœé¡¯ç¤º -->
                <div id="distance-result"
                     class="distance-info"
                     style="display: none;">
                  <div class="distance-display">
                    <span class="distance-icon">ğŸ“</span>
                    <span class="distance-text">è·é›¢åº—å®¶: <span id="distance-value">-</span>å…¬é‡Œ</span>
                  </div>
                  <div class="delivery-level"
                       id="delivery-level">
                    <span class="level-icon">ğŸšš</span>
                    <span class="level-text">å¤–é€ç´šåˆ¥: <span id="level-value">-</span></span>
                  </div>
                  <div class="free-shipping-info"
                       id="free-shipping-info">
                    <span class="free-icon">ğŸ’°</span>
                    <span class="free-text">å…é‹æ¢ä»¶: <span id="free-shipping-value">-</span></span>
                  </div>

                  <!-- å…é‹æé†’å€åŸŸ -->
                  <div id="shipping-reminder"
                       class="shipping-reminder"
                       style="display: none; margin-top: 12px; padding: 12px; background: rgba(45, 90, 39, 0.06); border-radius: 14px; border-left: 4px solid var(--kt-primary);">
                    <div id="shipping-reminder-content">
                      <!-- å‹•æ…‹å…§å®¹å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                    </div>
                  </div>
                </div>
              </div>
              <div class="info-group">
                <label for="delivery-time">å¸Œæœ›é€é”æ™‚é–“</label>
                <div class="delivery-time-row" style="display: flex; gap: 10px; align-items: center;">
                  <input type="time"
                         id="delivery-time"
                         min="10:00"
                         max="17:00"
                         step="1800"
                         style="flex: 1; min-width: 0; padding: 12px 14px; border: 1px solid var(--kt-border); border-radius: 14px; font-size: 1rem;">
                  <select id="delivery-time-unit"
                          style="flex: 0 0 80px; padding: 12px 14px; border: 1px solid var(--kt-border); border-radius: 14px; font-size: 1rem; background: white;">
                    <option value="æ•´">æ•´</option>
                    <option value="å‰">å‰</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- é è¦½å€åŸŸ -->
          <div class="section">
            <h2 class="section-title">è«‹ç¢ºèªä»¥ä¸‹è¨‚å–®é è¦½</h2>
            <div class="preview-area"
                 id="order-preview">è«‹å…ˆå¡«å¯«è¨‚è³¼è³‡è¨Šå’Œé¸æ“‡é£²å“...</div>

            <div class="order-controls">
              <button class="btn btn-secondary"
                      id="save-order">ğŸ’¾ å„²å­˜è¨‚å–®</button>
              <button class="btn btn-secondary"
                      id="load-orders">ğŸ“‹ è¼‰å…¥è¨‚å–®</button>
              <button class="btn btn-secondary"
                      id="clear-order">ğŸ—‘ï¸ æ¸…ç©ºè¨‚å–®</button>
            </div>

            <button class="copy-btn"
                    id="copy-order"
                    disabled>ğŸ“‹ è¤‡è£½è¨‚å–®æ–‡å­—å¾Œé»æ“Šä¸‹æ–¹â†“</button>
            <button class="btn btn-primary"
                    id="send-order"
                    disabled>å°‡è¨‚å–®ç™¼é€åˆ° LINE å®˜æ–¹å¸³è™Ÿ</button>

            <!-- è¯çµ¡æ–¹å¼å€åŸŸ -->
            <div class="contact-links-container"
                 style="margin-top: 20px; text-align: center; display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
              <a href="tel:03-4882975"
                 class="phone-link">
                <span class="delivery-icon phone-icon">ğŸ“</span>é›»è©±ï¼š03-4882975
              </a>
              <a href="https://maps.app.goo.gl/DmhQah32YQhwvBE98"
                 target="_blank"
                 class="nav-link">
                ğŸ—ºï¸ å°èˆªåˆ°å››ç¶­è·¯90è™Ÿ
              </a>
            </div>
          </div>
        </div>

        <!-- å¤–é€é‡‘é¡æŸ¥è©¢å€åŸŸ -->
        <div class="section"
             style="margin-top: 30px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 class="section-title"
                style="margin-bottom: 0; white-space: nowrap;">å¤–é€å…é‹æ¢ä»¶æŸ¥è©¢</h2>
            <button id="toggle-delivery-fee"
                    class="btn btn-secondary"
                    style="padding: 8px 15px; font-size: 0.9rem; position: relative; z-index: 10; cursor: pointer;">
              ğŸ“‹ é¡¯ç¤ºæŸ¥è©¢è¡¨
            </button>
          </div>

          <div id="delivery-fee-content"
               style="display: none; max-width: 900px; margin: 0 auto;">
            <div style="background: var(--kt-bg); border-radius: var(--kt-radius); padding: 20px; margin-bottom: 15px;">
              <h3 style="color: var(--kt-primary); margin-bottom: 15px; text-align: center;">ğŸšš å¤–é€è·é›¢èˆ‡é‹è²»å°ç…§è¡¨</h3>
              <div style="overflow-x: auto;">
                <table id="delivery-fee-table"
                       style="width: 100%; max-width: 800px; margin: 0 auto; border-collapse: collapse; font-size: 0.65rem;">
                  <thead>
                    <tr style="background: var(--kt-primary); color: white;">
                      <th style="padding: 4px 3px; border: 1px solid #ddd; text-align: center; font-size: 0.65rem;">
                        å¤–é€è·é›¢</th>
                      <th style="padding: 4px 3px; border: 1px solid #ddd; text-align: center; font-size: 0.65rem;">é‹è²»
                      </th>
                      <th style="padding: 4px 3px; border: 1px solid #ddd; text-align: center; font-size: 0.65rem;">
                        å…é‹è²»æ¢ä»¶</th>
                      <th style="padding: 4px 3px; border: 1px solid #ddd; text-align: center; font-size: 0.65rem;">
                        è¨‚è³¼é‡‘é¡éœ€é”</th>
                    </tr>
                  </thead>
                  <tbody id="delivery-fee-tbody">
                    <!-- å‹•æ…‹ç”Ÿæˆè¡¨æ ¼å…§å®¹ -->
                  </tbody>
                </table>
              </div>
            </div>

            <div
                 style="background: rgba(45, 90, 39, 0.08); border-left: 4px solid var(--kt-primary); padding: 16px; border-radius: var(--kt-radius); margin-bottom: 15px;">
              <h4 style="color: var(--kt-primary); margin-bottom: 10px; font-weight: 600;">ğŸ’¡ ä½¿ç”¨èªªæ˜ï¼š</h4>
              <ul style="margin: 0; padding-left: 20px; color: var(--kt-text);">
                <li>æ ¹æ“šæ‚¨çš„åœ°å€è·é›¢é¸æ“‡å°æ‡‰çš„é‹è²»</li>
                <li>é”åˆ°å…é‹è²»æ¢ä»¶å³å¯å…æ”¶é‹è²»</li>
                <li>æœªé”å…é‹æ¢ä»¶æ™‚ï¼Œéœ€æ”¯ä»˜å°æ‡‰é‹è²»</li>
                <li>æœ€ä½è¨‚è³¼é‡‘é¡è«‹åƒè€ƒã€Œè¨‚è³¼é‡‘é¡éœ€é”ã€æ¬„ä½</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- å¯¦ç”¨å·¥å…·å€åŸŸ -->
        <div class="section"
             style="margin-top: 30px;">
          <h2 class="section-title">å¯¦ç”¨å·¥å…·</h2>
          <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
            <a href="https://property-rr6ksz.manus.space"
               target="_blank"
               class="nav-link"
               style="background: linear-gradient(135deg, #4CAF50, #45a049);">
              ğŸ  è²·è³£è©¦ç®—ç³»çµ±
            </a>
            <a href="https://lin.ee/HzGBJ8e"
               target="_blank"
               class="nav-link"
               style="background: linear-gradient(135deg, #00C300, #00A000);">
              ğŸ  å…è²»è«®è©¢æˆ¿åœ°ç”¢
            </a>
            <a href="https://realtor.houseprice.tw/agent/buy/0925666597/"
               target="_blank"
               class="nav-link"
               style="background: linear-gradient(135deg, #FF6B35, #E55A2B);">
              ğŸ¡ æˆ¿å±‹ç²¾é¸ç‰©ä»¶
            </a>
            <a href="https://line.me/ti/g2/VXIuR9NyhkWFQPuMeWTUp_RHitaW82_0r8MU1Q?utm_source=invitation&utm_medium=link_copy&utm_campaign=default"
               target="_blank"
               class="nav-link"
               style="background: linear-gradient(135deg, #00C300, #00A000);">
              ğŸ½ï¸ å››ç¶­å•†åœˆé¤è»Šç¾¤
            </a>
          </div>
        </div>
      </div>

      <!-- å¯æ„›æé†’æ¡† -->
      <div id="cute-alert"
           class="cute-alert">
        <div class="cute-alert-content">
          <div class="cute-alert-header">
            <div class="cute-alert-icon"
                 id="alert-icon">ğŸ˜Š</div>
            <h3 class="cute-alert-title"
                id="alert-title">æº«é¦¨æé†’</h3>
          </div>
          <div class="cute-alert-body">
            <div class="cute-alert-message"
                 id="alert-message">è«‹å…ˆå¡«å¯«å®Œæ•´çš„è¨‚è³¼è³‡è¨Šï¼</div>
            <div class="cute-alert-details"
                 id="alert-details"
                 style="display: none;">
              <div>ğŸ“ è«‹å¡«å¯«ä»¥ä¸‹è³‡è¨Šï¼š</div>
              <div id="missing-fields"></div>
            </div>
            <button class="cute-alert-button"
                    id="alert-ok-btn">å¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼</button>
          </div>
        </div>
      </div>

      <!-- èœå–®æŸ¥çœ‹æ¨¡æ…‹æ¡† -->
      <div id="menu-modal"
           class="modal">
        <div class="modal-content"
             style="max-width: 90%; max-height: 90vh; overflow-y: auto;">
          <h3 class="modal-title">åŠŸå¤«èŒ¶æ¥Šæ¢…å››ç¶­åº—å®Œæ•´èœå–®</h3>
          <div style="text-align: center; margin: 20px 0;">
            <img src="https://res.cloudinary.com/diiyszovx/image/upload/v1757818170/DM_o9gvtj.png"
                 alt="åŠŸå¤«èŒ¶å®Œæ•´èœå–®"
                 style="max-width: 80%; max-height: 70vh; height: auto; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
          </div>
          <div class="modal-buttons">
            <button class="btn btn-secondary"
                    id="close-menu-modal">é—œé–‰</button>
          </div>
        </div>
      </div>

      <!-- é¸æ“‡é¸é …çš„æ¨¡æ…‹æ¡† -->
      <div id="order-modal"
           class="modal">
        <div class="modal-content">
          <h3 class="modal-title"
              id="modal-title">é¸æ“‡é£²å“é¸é …</h3>

          <div class="option-group">
            <label>å°ºå¯¸åƒ¹æ ¼</label>
            <div class="option-buttons"
                 id="size-options"></div>
          </div>

          <div class="option-group"
               id="sugar-group">
            <label>ç”œåº¦</label>
            <div class="option-buttons"
                 id="sugar-options">
              <div class="option-btn selected"
                   data-value="å…¨ç³–">å…¨ç³–</div>
              <div class="option-btn"
                   data-value="å°‘ç³–">å°‘ç³–</div>
              <div class="option-btn"
                   data-value="åŠç³–">åŠç³–</div>
              <div class="option-btn"
                   data-value="å¾®ç³–">å¾®ç³–</div>
              <div class="option-btn"
                   data-value="ç„¡ç³–">ç„¡ç³–</div>
            </div>
          </div>

          <div class="option-group"
               id="ice-group">
            <label>å†°å¡Š</label>
            <div class="option-buttons"
                 id="ice-options">
              <div class="option-btn selected"
                   data-value="æ­£å†°">æ­£å†°</div>
              <div class="option-btn"
                   data-value="å°‘å†°">å°‘å†°</div>
              <div class="option-btn"
                   data-value="å¾®å†°">å¾®å†°</div>
              <div class="option-btn"
                   data-value="å»å†°">å»å†°</div>
              <div class="option-btn"
                   data-value="ç†±é£²">ç†±é£²</div>
            </div>
          </div>

          <div class="option-group"
               id="tea-group"
               style="display: none;">
            <label>èŒ¶å“é¸æ“‡</label>
            <div class="option-buttons"
                 id="tea-options"></div>
          </div>

          <div class="option-group"
               id="toppings-group"
               style="display: none;">
            <label>åŠ æ–™é¸æ“‡</label>
            <div class="option-buttons"
                 id="toppings-options"></div>
          </div>

          <div class="quantity-input">
            <label for="quantity">æ•¸é‡</label>
            <div class="quantity-stepper">
              <button type="button" class="quantity-stepper-btn" id="quantity-minus" aria-label="æ¸›å°‘">âˆ’</button>
              <input type="number"
                     id="quantity"
                     min="1"
                     value="1"
                     pattern="[0-9]*"
                     inputmode="numeric">
              <button type="button" class="quantity-stepper-btn" id="quantity-plus" aria-label="å¢åŠ ">+</button>
            </div>
          </div>

          <div class="modal-buttons">
            <button class="btn btn-primary"
                    id="add-to-order">åŠ å…¥è¨‚å–®</button>
            <button class="btn btn-secondary"
                    id="cancel-order">å–æ¶ˆ</button>
          </div>
        </div>
      </div>

      <script>
        // åŠ æ–™é¸é …è³‡æ–™
        const toppings = [
          { name: "é»‘ç³–æ³¢éœ¸", price: 10, displayName: "æ³¢éœ¸" },
          { name: "ä»™è‰", price: 10, displayName: "ä»™è‰" },
          { name: "å¯’å¤©çƒ", price: 10, displayName: "å¯’å¤©çƒ" },
          { name: "è’Ÿè’»", price: 10, displayName: "è’Ÿè’»" },
          { name: "æ¤°æœ", price: 10, displayName: "æ¤°æœ" },
          { name: "38æ–™", price: 10, displayName: "38æ–™" }
        ];

        // é£²å“è³‡æ–™
        const menuData = [
          // è¯åãƒ»ç‰¹é¸
          { name: "é»‘éœ¸çƒé¾å¥¶", category: "è¯åãƒ»ç‰¹é¸", prices: { 'L': 60 }, notes: "æœŸé–“é™å®š", canAddToppings: true },

          // åŠŸå¤«ãƒ»å¥½èŒ¶
          { name: "åŠŸå¤«èŒ¶ç‹", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 45, 'ç“¶': 45 }, notes: "â˜… ç„¡ç³–å¾®å†°é™å®š, ä¸å¯åŠ æ–™", fixedOptions: { sugar: "ç„¡ç³–", ice: "å¾®å†°" }, canAddToppings: false },
          { name: "éš±å±±çƒé¾", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 45, 'ç“¶': 45 }, notes: "â˜… ç„¡ç³–é™å®š, ä¸å¯åŠ æ–™", fixedOptions: { sugar: "ç„¡ç³–" }, canAddToppings: false },
          { name: "å²©è‘‰ç´…èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 35, 'ç“¶': 55 }, canAddToppings: true },
          { name: "ç¿ ç‰ç¶ èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 35, 'ç“¶': 55 }, canAddToppings: true },
          { name: "å››å­£æ˜¥é’èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 35, 'ç“¶': 55 }, canAddToppings: true },
          { name: "çƒé¾éµè§€éŸ³", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 35, 'ç“¶': 55 }, canAddToppings: true },
          { name: "èœœæ¡ƒèƒ­è„‚ç´…èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 40, 'ç“¶': 60 }, canAddToppings: true },
          { name: "æ‰‹ä½œå†¬ç“œèŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 35 }, notes: "ç„¡å¤–åŠ ç³–", canAddToppings: true },
          { name: "é˜¿é‡Œå±±å†°èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 50 }, notes: "é™å”®, ä¸å¯åŠ æ–™, ä¸å¯åšç†±é£²", canAddToppings: false },
          { name: "æ—¥æœˆæ½­ç´…ç‰", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 50 }, notes: "é™å”®, ä¸å¯åŠ æ–™, ä¸å¯åšç†±é£²", canAddToppings: false },
          { name: "èŠå£«å¥¶è“‹ç¶ èŒ¶/é’èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 70 }, teaOptions: ["ç¶ èŒ¶", "é’èŒ¶"], canAddToppings: true },
          { name: "èŠå£«å¥¶è“‹ç´…èŒ¶/çƒé¾", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 70 }, teaOptions: ["ç´…èŒ¶", "çƒé¾"], canAddToppings: true },
          { name: "ç«ç‘°å†°èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 55 }, notes: "ç„¡å¤–åŠ ç³–", canAddToppings: true },
          { name: "é’æ¢…ç¶ èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 55 }, canAddToppings: true },
          { name: "å¤šå¤šç¶ èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 60 }, canAddToppings: true },
          { name: "èƒ­è„‚å¤šå¤š", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 60 }, canAddToppings: true },
          { name: "ç²‰ç²¿èƒ­è„‚ç´…", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 50 }, canAddToppings: true },
          { name: "å†°æ·‡æ·‹å²©è‘‰ç´…èŒ¶", category: "åŠŸå¤«ãƒ»å¥½èŒ¶", prices: { 'L': 60 }, notes: "æœ€ä½å¾®å†°", canAddToppings: true },

          // åŠŸå¤«ãƒ»é®®å¥¶
          { name: "é»‘ç³–æ³¢éœ¸é®®å¥¶", category: "åŠŸå¤«ãƒ»é®®å¥¶", prices: { 'M': 65, 'L': 80 }, notes: "ç„¡å¤–åŠ ç³–, æœ€ä½å¾®å†°", noSugarOptions: true, canAddToppings: true },
          { name: "ç´…è±†ç²‰ç²¿é®®å¥¶", category: "åŠŸå¤«ãƒ»é®®å¥¶", prices: { 'M': 65, 'L': 80 }, notes: "ç„¡å¤–åŠ ç³–, å›ºå®šå¾®å†°", fixedOptions: { sugar: "ç„¡å¤–åŠ ç³–", ice: "å¾®å†°" }, canAddToppings: false },
          { name: "å·§å…‹åŠ›é®®å¥¶", category: "åŠŸå¤«ãƒ»é®®å¥¶", prices: { 'M': 75 }, canAddToppings: true },
          { name: "å²©è‘‰ç´…èŒ¶æ‹¿éµ", category: "åŠŸå¤«ãƒ»é®®å¥¶", prices: { 'M': 55, 'L': 65 }, canAddToppings: true },
          { name: "çƒé¾è§€éŸ³æ‹¿éµ", category: "åŠŸå¤«ãƒ»é®®å¥¶", prices: { 'M': 55, 'L': 65 }, canAddToppings: true },
          { name: "è‹±å¼ä¼¯çˆµæ‹¿éµ", category: "åŠŸå¤«ãƒ»é®®å¥¶", prices: { 'M': 70 }, canAddToppings: true },
          { name: "èœœæ¡ƒèƒ­è„‚æ‹¿éµ", category: "åŠŸå¤«ãƒ»é®®å¥¶", prices: { 'M': 70 }, canAddToppings: true },
          { name: "å†°æ·‡æ·‹ç´…èŒ¶æ‹¿éµ", category: "åŠŸå¤«ãƒ»é®®å¥¶", prices: { 'M': 75 }, notes: "æœ€ä½å¾®å†°", canAddToppings: true },

          // åŠŸå¤«ãƒ»å¥¶èŒ¶
          { name: "38å¥¶éœ¸", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 60, 'L': 65 }, notes: "æ³¢éœ¸+çç +ä»™è‰", canAddToppings: false },
          { name: "é»‘ç³–æ³¢éœ¸å¥¶èŒ¶", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 55, 'L': 60 }, notes: "â˜…", canAddToppings: true },
          { name: "å’–å•¡å‡å¥¶èŒ¶", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 60, 'L': 65 }, canAddToppings: true },
          { name: "åšå¥¶èŒ¶/å¥¶ç¶ ", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 50, 'L': 55 }, canAddToppings: true },
          { name: "çƒé¾è§€éŸ³å¥¶èŒ¶", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 50, 'L': 55 }, canAddToppings: true },
          { name: "è‹±å¼ä¼¯çˆµå¥¶èŒ¶", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 65 }, canAddToppings: true },
          { name: "èœœæ¡ƒèƒ­è„‚å¥¶èŒ¶", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 65 }, canAddToppings: true },
          { name: "èŠåœ’ç«ç‘°å¥¶èŒ¶", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 65 }, canAddToppings: true },
          { name: "å·§å…‹åŠ›å¥¶èŒ¶", category: "åŠŸå¤«ãƒ»å¥¶èŒ¶", prices: { 'M': 65 }, canAddToppings: true },

          // åŠŸå¤«ãƒ»æ°´æœ
          { name: "è¼•é£²æ°´æœèŒ¶ç‹", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 65 }, notes: "â˜… æ¨è–¦, ä¸å¯åŠ æ–™", canAddToppings: false },
          { name: "å¯’å¤©æŸšé¦™é£²", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 65 }, canAddToppings: true },
          { name: "ç²‰ç²¿æŸšé¦™ç¶ ", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 65 }, canAddToppings: true },
          { name: "é®®æ¦¨æŸ³æ©™ç¶ ", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 65 }, notes: "å›ºå®šåŠç³–", fixedOptions: { sugar: "åŠç³–" }, canAddToppings: true },
          { name: "èŠ­æ¨‚æª¸æª¬ç¶ ", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 75 }, notes: "â˜… åŠç³–å¾®å†°", fixedOptions: { sugar: "åŠç³–", ice: "å¾®å†°" }, canAddToppings: false },
          { name: "é»ƒé‡‘èŠ’æœç¶ ", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 60 }, canAddToppings: true },
          { name: "ç™¾é¦™3Q", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 60 }, notes: "ä¸å«èŒ¶, æ³¢éœ¸+çç +æ¤°æœ", canAddToppings: false },
          { name: "ç™¾é¦™ç¾…å‹’å­", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 55 }, notes: "ä¸å«èŒ¶", canAddToppings: true },
          { name: "å†¬ç“œæª¸æª¬", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 60 }, notes: "ä¸å«èŒ¶, ç„¡å¤–åŠ ç³–", noSugarOptions: true, canAddToppings: true },
          { name: "é»ƒé‡‘èŠ’æœèè", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 60 }, notes: "ä¸å«èŒ¶, å†°æ²™", fixedOptions: { sugar: "", ice: "å†°æ²™" }, noSugarOptions: true, canAddToppings: false },
          { name: "æ³°å¼æ¦´æ§¤èè", category: "åŠŸå¤«ãƒ»æ°´æœ", prices: { 'L': 110 }, notes: "â˜… ä¸­æ¯é™å®š, å†°æ²™", fixedOptions: { sugar: "", ice: "å†°æ²™" }, noSugarOptions: true, canAddToppings: false },

          // å†¬å­£ãƒ»é™å®š
          { name: "æš–è–‘å¥¶èŒ¶", category: "å†¬å­£ãƒ»é™å®š", prices: { 'L': 60 }, canAddToppings: true },
          { name: "æš–è–‘é®®å¥¶", category: "å†¬å­£ãƒ»é™å®š", prices: { 'L': 70 }, notes: "ä¸å«èŒ¶", canAddToppings: true },
          { name: "è–‘æ±æ¡‚åœ“ç´…æ£—", category: "å†¬å­£ãƒ»é™å®š", prices: { 'L': 60 }, notes: "ä¸å«èŒ¶, ç„¡å¤–åŠ ç³–", noSugarOptions: true, canAddToppings: true },
        ];

        // å…¨åŸŸè®Šæ•¸
        let currentOrder = [];
        let currentBeverage = null;
        let savedOrders = JSON.parse(localStorage.getItem('kungfuTeaOrders') || '[]');

        // DOM å…ƒç´ 
        const menuContainer = document.getElementById('menu-container');
        const orderContainer = document.getElementById('order-container');
        const totalAmountEl = document.getElementById('total-amount');
        const orderPreview = document.getElementById('order-preview');
        const copyOrderBtn = document.getElementById('copy-order');
        const sendOrderBtn = document.getElementById('send-order');
        const clearOrderBtn = document.getElementById('clear-order');
        const saveOrderBtn = document.getElementById('save-order');
        const loadOrdersBtn = document.getElementById('load-orders');
        const modal = document.getElementById('order-modal');
        const modalTitle = document.getElementById('modal-title');
        const sizeOptions = document.getElementById('size-options');
        const quantityInput = document.getElementById('quantity');
        const addToOrderBtn = document.getElementById('add-to-order');
        const cancelOrderBtn = document.getElementById('cancel-order');

        // è¨‚è³¼è³‡è¨Šè¼¸å…¥æ¡†
        const customerName = document.getElementById('customer-name');
        const customerPhone = document.getElementById('customer-phone');
        const deliveryAddress = document.getElementById('delivery-address');
        const deliveryTime = document.getElementById('delivery-time');
        const deliveryTimeUnit = document.getElementById('delivery-time-unit');
        const BACKEND_API_URL = (window.KUNGFU_TEA_BACKEND_API_URL || 'http://localhost:3000/api').trim();

        // åˆå§‹åŒ–èœå–®
        function initMenu() {
          const categories = [...new Set(menuData.map(item => item.category))];

          categories.forEach(category => {
            const categoryDropdown = document.createElement('div');
            categoryDropdown.className = 'category-dropdown';

            const categoryHeader = document.createElement('div');
            categoryHeader.className = 'category-header';
            categoryHeader.innerHTML = `
                    ${category}
                    <span class="dropdown-arrow">â–¼</span>
                `;

            const categoryContent = document.createElement('div');
            categoryContent.className = 'category-content';

            // å‰µå»ºè©²åˆ†é¡ä¸‹çš„é£²å“
            const categoryItems = menuData.filter(item => item.category === category);
            categoryItems.forEach(beverage => {
              const beverageEl = createBeverageElement(beverage);
              categoryContent.appendChild(beverageEl);
            });

            // é»æ“Šæ¨™é¡Œåˆ‡æ›å±•é–‹/æ”¶èµ·
            categoryHeader.addEventListener('click', () => {
              const arrow = categoryHeader.querySelector('.dropdown-arrow');
              const isActive = categoryContent.classList.contains('active');

              if (isActive) {
                categoryContent.classList.remove('active');
                arrow.classList.remove('rotated');
              } else {
                categoryContent.classList.add('active');
                arrow.classList.add('rotated');
              }
            });

            categoryDropdown.appendChild(categoryHeader);
            categoryDropdown.appendChild(categoryContent);
            menuContainer.appendChild(categoryDropdown);
          });
        }

        // å‰µå»ºé£²å“å…ƒç´ 
        function createBeverageElement(beverage) {
          const beverageEl = document.createElement('div');
          beverageEl.className = 'beverage-item';
          beverageEl.onclick = () => openOrderModal(beverage);

          const pricesText = Object.entries(beverage.prices)
            .map(([size, price]) => `${size} $${price}`)
            .join(' / ');

          let notesHtml = '';
          if (beverage.notes) {
            // ç§»é™¤å‚™è¨»ä¸­çš„æ˜Ÿæ˜Ÿåœ–ç¤ºï¼Œå› ç‚ºå·²ç¶“ç§»åˆ°åç¨±å‰é¢
            const cleanNotes = beverage.notes.replace(/â˜…\s*/g, '');
            if (cleanNotes.trim()) {
              // æ ¹æ“šå‚™è¨»å…§å®¹æ±ºå®šæ¨£å¼é¡åˆ¥
              let noteClass = 'beverage-notes';
              if (cleanNotes.includes('æ¨è–¦')) {
                noteClass += ' recommended';
              } else if (cleanNotes.includes('ä¸å¯åŠ æ–™')) {
                noteClass += ' no-toppings';
              } else if (cleanNotes.includes('ç„¡å¦å¤–åŠ ç³–') || cleanNotes.includes('ç„¡ç³–')) {
                noteClass += ' no-sugar';
              } else if (cleanNotes.includes('ä¸å«èŒ¶')) {
                noteClass += ' no-tea';
              } else if (cleanNotes.includes('ç”œåº¦å›ºå®š') || cleanNotes.includes('å›ºå®š')) {
                noteClass += ' fixed-options';
              } else if (cleanNotes.includes('æœ€ä½å¾®å†°')) {
                noteClass += ' ice-limit';
              } else if (cleanNotes.includes('ä¸å«å’–å•¡å› ')) {
                noteClass += ' no-caffeine';
              } else if (cleanNotes.includes('å«') && (cleanNotes.includes('æ³¢éœ¸') || cleanNotes.includes('è’Ÿè’»') || cleanNotes.includes('ä»™è‰'))) {
                noteClass += ' included-toppings';
              } else if (cleanNotes.includes('å†°æ²™')) {
                noteClass += ' smoothie';
              } else if (cleanNotes.includes('é™å®š')) {
                noteClass += ' limited';
              } else if (cleanNotes.includes('ä¸å¯åšç†±é£²')) {
                noteClass += ' no-hot';
              } else if (cleanNotes.includes('é»ƒé‡‘æ¯”ä¾‹')) {
                noteClass += ' golden-ratio';
              }

              notesHtml = `<div class="${noteClass}">${cleanNotes}</div>`;
            }
          }

          // è™•ç†æ˜Ÿæ˜Ÿåœ–ç¤º
          let displayName = beverage.name;
          if (beverage.notes && beverage.notes.includes('â˜…')) {
            displayName = `<span class="star">â˜…</span> ${beverage.name}`;
          }

          beverageEl.innerHTML = `
            <div class="beverage-name-price">
                <div class="beverage-name-text">${displayName}</div>
                <div class="beverage-price-text">${pricesText}</div>
            </div>
            ${notesHtml}
        `;

          return beverageEl;
        }

        // å¯æ„›æé†’å‡½æ•¸
        function showCuteAlert(title, message, icon = 'ğŸ˜Š', details = null) {
          const alertModal = document.getElementById('cute-alert');
          const alertTitle = document.getElementById('alert-title');
          const alertMessage = document.getElementById('alert-message');
          const alertIcon = document.getElementById('alert-icon');
          const alertDetails = document.getElementById('alert-details');
          const missingFields = document.getElementById('missing-fields');
          const okBtn = document.getElementById('alert-ok-btn');

          alertTitle.textContent = title;
          alertMessage.textContent = message;
          alertIcon.textContent = icon;

          if (details) {
            alertDetails.style.display = 'block';
            missingFields.innerHTML = details;
          } else {
            alertDetails.style.display = 'none';
          }

          alertModal.style.display = 'block';

          // é»æ“Šç¢ºå®šæŒ‰éˆ•é—œé–‰
          okBtn.onclick = () => {
            alertModal.style.display = 'none';
          };

          // é»æ“ŠèƒŒæ™¯é—œé–‰
          alertModal.onclick = (e) => {
            if (e.target === alertModal) {
              alertModal.style.display = 'none';
            }
          };
        }

        // æª¢æŸ¥è¨‚è³¼è³‡è¨Šæ˜¯å¦å®Œæ•´
        function checkOrderInfo() {
          const name = customerName.value.trim();
          const phone = customerPhone.value.trim();
          const address = deliveryAddress.value.trim();
          const time = deliveryTime.value;
          const timeUnit = deliveryTimeUnit.value;

          // å…ˆé©—è­‰æ™‚é–“æ˜¯å¦åœ¨æœ‰æ•ˆç¯„åœå…§
          if (time && !validateDeliveryTime()) {
            deliveryTime.focus();
            return false;
          }

          if (!name || !phone || !address || !time) {
            // ç›´æ¥è·³è½‰åˆ°è¨‚è³¼äººå§“åæ¬„ä½
            customerName.scrollIntoView({ behavior: 'smooth', block: 'center' });
            customerName.focus();

            // é«˜äº®é¡¯ç¤ºæœªå¡«å¯«çš„æ¬„ä½
            const missingFields = [];
            if (!name) {
              customerName.style.borderColor = '#ff6b6b';
              missingFields.push('ğŸ‘¤ è¨‚è³¼äººå§“å');
            }
            if (!phone) {
              customerPhone.style.borderColor = '#ff6b6b';
              missingFields.push('ğŸ“ è¯çµ¡é›»è©±');
            }
            if (!address) {
              deliveryAddress.style.borderColor = '#ff6b6b';
              missingFields.push('ğŸ“ å¤–é€åœ°å€');
            }
            if (!time) {
              deliveryTime.style.borderColor = '#ff6b6b';
              missingFields.push('â° å¸Œæœ›é€é”æ™‚é–“');
            }

            const detailsHtml = missingFields.map(field => `<div style="margin: 5px 0; color: #e74c3c;">${field}</div>`).join('');

            showCuteAlert(
              'è«‹å…ˆå¡«å¯«è¨‚è³¼è³‡è¨Šï¼',
              'è¦ªæ„›çš„é¡§å®¢ï¼Œè«‹å…ˆå¡«å¯«å®Œæ•´çš„è¨‚è³¼è³‡è¨Šå¾Œå†é¸æ“‡é£²å“å“¦ï½',
              'ğŸ¤—',
              detailsHtml
            );
            return false;
          }
          return true;
        }

        // æ‰“é–‹è¨‚è³¼æ¨¡æ…‹æ¡†
        function openOrderModal(beverage) {
          // å…ˆæª¢æŸ¥è¨‚è³¼è³‡è¨Š
          if (!checkOrderInfo()) {
            return;
          }

          currentBeverage = beverage;
          modalTitle.textContent = beverage.name;

          // å‰µå»ºå°ºå¯¸é¸é …
          sizeOptions.innerHTML = '';
          const sizes = Object.keys(beverage.prices);

          sizes.forEach((size, index) => {
            const sizeBtn = document.createElement('div');
            sizeBtn.className = 'option-btn';
            if (index === 0) sizeBtn.classList.add('selected');
            sizeBtn.textContent = `${size} (${beverage.prices[size]})`;
            sizeBtn.onclick = () => selectOption(sizeBtn, 'size');
            sizeOptions.appendChild(sizeBtn);
          });

          // è™•ç†ç”œåº¦é¸é …
          const sugarGroup = document.getElementById('sugar-group');
          if (beverage.fixedOptions?.sugar || beverage.noSugarOptions) {
            sugarGroup.style.display = 'none';
          } else {
            sugarGroup.style.display = 'block';
            resetSugarSelections();
          }

          // è™•ç†å†°å¡Šé¸é …
          const iceGroup = document.getElementById('ice-group');
          if (beverage.fixedOptions?.ice) {
            iceGroup.style.display = 'none';
          } else {
            iceGroup.style.display = 'block';
            // ç‰¹æ®Šè™•ç†ï¼šå†°æ·‡æ·‹é£²å“åªé¡¯ç¤ºå¾®å†°ä»¥ä¸Šé¸é …
            if (beverage.name === 'å†°æ·‡æ·‹å²©è‘‰ç´…èŒ¶' || beverage.name === 'å†°æ·‡æ·‹ç´…èŒ¶æ‹¿éµ') {
              resetIceSelectionsForIceCream();
            } else if (beverage.name === 'é˜¿é‡Œå±±å†°èŒ¶' || beverage.name === 'æ—¥æœˆæ½­ç´…ç‰') {
              resetIceSelectionsNoHot();
            } else if (beverage.name === 'ç´…è±†ç²‰ç²¿é®®å¥¶') {
              resetIceSelectionsForRedBean();
            } else {
              resetIceSelections();
            }
          }

          // è™•ç†èŒ¶å“é¸é …
          const teaGroup = document.getElementById('tea-group');
          if (beverage.teaOptions) {
            teaGroup.style.display = 'block';
            createTeaOptions();
          } else {
            teaGroup.style.display = 'none';
          }

          // è™•ç†åŠ æ–™é¸é …
          const toppingsGroup = document.getElementById('toppings-group');
          if (beverage.canAddToppings) {
            toppingsGroup.style.display = 'block';
            createToppingsOptions();
          } else {
            toppingsGroup.style.display = 'none';
          }

          quantityInput.value = 1;
          modal.style.display = 'block';
        }

        // å‰µå»ºèŒ¶å“é¸é …
        function createTeaOptions() {
          const teaContainer = document.getElementById('tea-options');
          teaContainer.innerHTML = '';

          currentBeverage.teaOptions.forEach((tea, index) => {
            const teaBtn = document.createElement('div');
            teaBtn.className = 'option-btn';
            if (index === 0) teaBtn.classList.add('selected');
            teaBtn.textContent = tea;
            teaBtn.dataset.teaValue = tea;
            teaBtn.onclick = () => selectOption(teaBtn, 'tea');
            teaContainer.appendChild(teaBtn);
          });
        }

        // å‰µå»ºåŠ æ–™é¸é …
        function createToppingsOptions() {
          const toppingsContainer = document.getElementById('toppings-options');
          toppingsContainer.innerHTML = '';

          toppings.forEach(topping => {
            const toppingBtn = document.createElement('div');
            toppingBtn.className = 'option-btn';
            toppingBtn.textContent = `${topping.name} (+${topping.price})`;
            toppingBtn.dataset.toppingName = topping.name;
            toppingBtn.dataset.toppingPrice = topping.price;
            toppingBtn.onclick = () => toggleTopping(toppingBtn);
            toppingsContainer.appendChild(toppingBtn);
          });
        }

        // é—œé–‰è¨‚è³¼æ¨¡æ…‹æ¡†
        function closeOrderModal() {
          modal.style.display = 'none';
          currentBeverage = null;
        }

        // åŠ å…¥è¨‚å–®
        function addToOrder() {
          if (!currentBeverage) return;

          const selectedSize = document.querySelector('#size-options .option-btn.selected');
          const selectedSugar = document.querySelector('#sugar-options .option-btn.selected');
          const selectedIce = document.querySelector('#ice-options .option-btn.selected');
          const selectedTea = document.querySelector('#tea-options .option-btn.selected');
          const selectedToppings = document.querySelectorAll('#toppings-options .option-btn.selected');
          const quantity = parseInt(quantityInput.value) || 1;

          if (!selectedSize) {
            showCuteAlert('è«‹é¸æ“‡å°ºå¯¸ï¼', 'è«‹é¸æ“‡é£²å“å°ºå¯¸å¾Œå†åŠ å…¥è¨‚å–®å“¦ï½', 'ğŸ˜Š');
            return;
          }

          // æ§‹å»ºè¨‚å–®é …ç›®
          const orderItem = {
            beverage: currentBeverage,
            size: selectedSize.textContent.split(' (')[0],
            quantity: quantity,
            price: 0
          };

          // æ·»åŠ é¸é …
          if (selectedSugar && sugarGroup.style.display !== 'none') {
            orderItem.sugar = selectedSugar.dataset.value;
          }
          if (selectedIce && iceGroup.style.display !== 'none') {
            orderItem.ice = selectedIce.dataset.value;
          }
          if (selectedTea && teaGroup.style.display !== 'none') {
            orderItem.tea = selectedTea.dataset.teaValue;
          }

          // æ·»åŠ åŠ æ–™
          if (selectedToppings.length > 0 && toppingsGroup.style.display !== 'none') {
            orderItem.toppings = Array.from(selectedToppings).map(btn => btn.dataset.toppingName);
          }

          // è¨ˆç®—åƒ¹æ ¼
          const basePrice = currentBeverage.prices[orderItem.size];
          let toppingsPrice = 0;
          if (orderItem.toppings) {
            orderItem.toppings.forEach(toppingName => {
              const topping = toppings.find(t => t.name === toppingName);
              if (topping) {
                toppingsPrice += topping.price;
              }
            });
          }
          orderItem.price = (basePrice + toppingsPrice) * quantity;

          // æ·»åŠ åˆ°è¨‚å–®
          currentOrder.push(orderItem);

          // æ›´æ–°é¡¯ç¤º
          updateOrderDisplay();
          updateOrderPreview();

          // é—œé–‰æ¨¡æ…‹æ¡†
          closeOrderModal();

          // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
          showCuteAlert('å·²åŠ å…¥è¨‚å–®ï¼', `${currentBeverage.name} å·²æˆåŠŸåŠ å…¥æ‚¨çš„è¨‚å–®ä¸­ï½`, 'ğŸ‰');
        }

        // é¸æ“‡é¸é …
        function selectOption(btn, type) {
          const parentContainer = btn.parentNode;
          parentContainer.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
        }

        // åˆ‡æ›åŠ æ–™é¸æ“‡
        function toggleTopping(btn) {
          const isSelected = btn.classList.contains('selected');
          const toppingName = btn.dataset.toppingName;
          const selectedToppings = document.querySelectorAll('#toppings-options .option-btn.selected');

          // å¦‚æœé»æ“Šçš„æ˜¯38æ–™
          if (toppingName === '38æ–™') {
            if (isSelected) {
              // å–æ¶ˆé¸æ“‡38æ–™
              btn.classList.remove('selected');
            } else {
              // é¸æ“‡38æ–™æ™‚ï¼Œå–æ¶ˆæ‰€æœ‰å…¶ä»–åŠ æ–™
              selectedToppings.forEach(otherBtn => otherBtn.classList.remove('selected'));
              btn.classList.add('selected');
            }
          } else {
            // å¦‚æœé»æ“Šçš„æ˜¯å…¶ä»–åŠ æ–™
            if (isSelected) {
              // å–æ¶ˆé¸æ“‡
              btn.classList.remove('selected');
            } else {
              // æª¢æŸ¥æ˜¯å¦å·²ç¶“é¸äº†38æ–™
              const specialTopping = document.querySelector('#toppings-options .option-btn[data-topping-name="38æ–™"]');
              if (specialTopping && specialTopping.classList.contains('selected')) {
                showCuteAlert(
                  'åŠ æ–™æé†’ï¼',
                  'é¸æ“‡38æ–™æ™‚ä¸èƒ½åŒæ™‚é¸æ“‡å…¶ä»–åŠ æ–™å“¦ï½',
                  'âš ï¸'
                );
                return;
              }

              // æª¢æŸ¥æ˜¯å¦å·²é”åˆ°3ç¨®åŠ æ–™çš„é™åˆ¶
              if (selectedToppings.length >= 3) {
                showCuteAlert(
                  'åŠ æ–™é™åˆ¶ï¼',
                  'ä¸€æ¯é£²æ–™æœ€å¤šåªèƒ½åŠ 3ç¨®æ–™å“¦ï½',
                  'ğŸš«'
                );
                return;
              }

              btn.classList.add('selected');
            }
          }
        }

        // é¸æ“‡é¸é … (å°ºå¯¸ã€ç”œåº¦ã€å†°å¡Š) - å·²åœ¨ä¸Šæ–¹å®šç¾©

        // é‡ç½®ç”œåº¦é¸é …
        function resetSugarSelections() {
          document.querySelectorAll('#sugar-options .option-btn').forEach((btn, index) => {
            btn.classList.toggle('selected', index === 0);
          });
        }

        // é‡ç½®å†°å¡Šé¸é …
        function resetIceSelections() {
          document.querySelectorAll('#ice-options .option-btn').forEach((btn, index) => {
            btn.style.display = 'block'; // ç¢ºä¿æ‰€æœ‰é¸é …éƒ½é¡¯ç¤º
            btn.classList.toggle('selected', index === 0);
          });
        }

        // é‡ç½®å†°æ·‡æ·‹é£²å“çš„å†°å¡Šé¸é …ï¼ˆåªé¡¯ç¤ºå¾®å†°ä»¥ä¸Šï¼‰
        function resetIceSelectionsForIceCream() {
          const iceOptions = document.querySelectorAll('#ice-options .option-btn');
          iceOptions.forEach((btn, index) => {
            const value = btn.dataset.value;
            // åªé¡¯ç¤ºå¾®å†°ã€å°‘å†°ã€æ­£å†°ï¼Œéš±è—å»å†°å’Œç†±é£²
            if (value === 'å»å†°' || value === 'ç†±é£²') {
              btn.style.display = 'none';
            } else {
              btn.style.display = 'block';
              btn.classList.toggle('selected', index === 0);
            }
          });
        }

        // é‡ç½®ä¸èƒ½åšç†±é£²çš„é£²å“å†°å¡Šé¸é …ï¼ˆéš±è—ç†±é£²é¸é …ï¼‰
        function resetIceSelectionsNoHot() {
          const iceOptions = document.querySelectorAll('#ice-options .option-btn');
          iceOptions.forEach((btn, index) => {
            const value = btn.dataset.value;
            // éš±è—ç†±é£²é¸é …ï¼Œå…¶ä»–éƒ½é¡¯ç¤º
            if (value === 'ç†±é£²') {
              btn.style.display = 'none';
            } else {
              btn.style.display = 'block';
              btn.classList.toggle('selected', index === 0);
            }
          });
        }

        // é‡ç½®ç´…è±†ç²‰ç²¿é®®å¥¶çš„å†°å¡Šé¸é …ï¼ˆå›ºå®šå¾®å†°ï¼‰
        function resetIceSelectionsForRedBean() {
          const iceOptions = document.querySelectorAll('#ice-options .option-btn');
          iceOptions.forEach((btn, index) => {
            const value = btn.dataset.value;
            // å›ºå®šå¾®å†°ï¼Œåªé¡¯ç¤ºå¾®å†°
            if (value === 'å¾®å†°') {
              btn.style.display = 'block';
              btn.classList.add('selected');
            } else {
              btn.style.display = 'none';
              btn.classList.remove('selected');
            }
          });
        }

        // åŠ å…¥è¨‚å–®
        addToOrderBtn.onclick = () => {
          const selectedSizeBtn = document.querySelector('#size-options .option-btn.selected');
          const sizeText = selectedSizeBtn.textContent;
          const size = sizeText.split(' ')[0];
          const quantity = parseInt(quantityInput.value);

          if (quantity <= 0) {
            showCuteAlert(
              'æ•¸é‡éŒ¯èª¤ï¼',
              'æ•¸é‡å¿…é ˆå¤§æ–¼ 0 å“¦ï½',
              'âŒ'
            );
            return;
          }

          // è™•ç†ç”œåº¦é¸é …
          let sugar = "å…¨ç³–";
          if (currentBeverage.fixedOptions?.sugar) {
            sugar = currentBeverage.fixedOptions.sugar;
          } else if (currentBeverage.noSugarOptions) {
            sugar = ""; // ä¸é¡¯ç¤ºç”œåº¦
          } else {
            const selectedSugarBtn = document.querySelector('#sugar-options .option-btn.selected');
            if (selectedSugarBtn) {
              sugar = selectedSugarBtn.dataset.value;
            }
          }

          // è™•ç†å†°å¡Šé¸é …
          let ice = "æ­£å†°";
          if (currentBeverage.fixedOptions?.ice) {
            ice = currentBeverage.fixedOptions.ice;
          } else {
            const selectedIceBtn = document.querySelector('#ice-options .option-btn.selected');
            if (selectedIceBtn) {
              ice = selectedIceBtn.dataset.value;
            }
          }

          // è™•ç†èŒ¶å“é¸é …
          let selectedTea = '';
          if (currentBeverage.teaOptions) {
            const selectedTeaBtn = document.querySelector('#tea-options .option-btn.selected');
            if (selectedTeaBtn) {
              selectedTea = selectedTeaBtn.dataset.teaValue;
            }
          }

          // è™•ç†åŠ æ–™é¸é …
          const selectedToppings = [];
          let toppingsPrice = 0;
          if (currentBeverage.canAddToppings) {
            document.querySelectorAll('#toppings-options .option-btn.selected').forEach(btn => {
              const toppingName = btn.dataset.toppingName;
              const toppingPrice = parseInt(btn.dataset.toppingPrice);
              selectedToppings.push(toppingName);
              toppingsPrice += toppingPrice;
            });
          }

          const basePrice = currentBeverage.prices[size];
          const totalPrice = (basePrice + toppingsPrice) * quantity;

          const orderItem = {
            beverage: currentBeverage,
            size: size,
            sugar: sugar,
            ice: ice,
            tea: selectedTea,
            toppings: selectedToppings,
            quantity: quantity,
            price: totalPrice
          };

          currentOrder.push(orderItem);
          updateOrderDisplay();
          updateOrderPreview();
          modal.style.display = 'none';
        };

        // å–æ¶ˆè¨‚è³¼
        cancelOrderBtn.onclick = () => {
          modal.style.display = 'none';
        };

        // æ›´æ–°è¨‚å–®é¡¯ç¤º
        function updateOrderDisplay() {
          if (currentOrder.length === 0) {
            orderContainer.innerHTML = '<div class="empty-order">å°šæœªé¸æ“‡ä»»ä½•é£²å“</div>';
          } else {
            orderContainer.innerHTML = '';
            currentOrder.forEach((item, index) => {
              const orderItemEl = createOrderItemElement(item, index);
              orderContainer.appendChild(orderItemEl);
            });
          }

          // æ›´æ–°ç¸½é‡‘é¡
          const total = currentOrder.reduce((sum, item) => sum + item.price, 0);
          totalAmountEl.textContent = total;

          // æ›´æ–°å…é‹æé†’ï¼ˆå¦‚æœå¤–é€åœ°å€å·²å¡«å¯«ï¼‰
          const deliveryAddress = document.getElementById('delivery-address');
          if (deliveryAddress && deliveryAddress.value.trim().length > 5) {
            const distanceResult = document.getElementById('distance-result');
            if (distanceResult && distanceResult.style.display !== 'none') {
              // é‡æ–°è¨ˆç®—è·é›¢ä»¥ç²å–æœ€æ–°çš„å¤–é€ç´šåˆ¥
              useBackupDistanceCalculation(deliveryAddress.value.trim());
            }
          }
        }

        // å‰µå»ºè¨‚å–®é …ç›®å…ƒç´ 
        function createOrderItemElement(item, index) {
          const orderItemEl = document.createElement('div');
          orderItemEl.className = 'order-item';

          // çµ„åˆç”œåº¦å†°å¡ŠèŒ¶å“æ–‡å­—
          let optionsText = '';
          const options = [];
          if (item.tea) options.push(item.tea);
          if (item.sugar) options.push(item.sugar);
          if (item.ice) options.push(item.ice);
          optionsText = options.join(' / ');

          // åŠ æ–™æ–‡å­—
          let toppingsText = '';
          if (item.toppings && item.toppings.length > 0) {
            const displayToppings = item.toppings.map(toppingName => {
              const topping = toppings.find(t => t.name === toppingName);
              return topping ? topping.displayName : toppingName;
            });
            toppingsText = `<div style="color: var(--kt-primary); font-size: 0.8rem;">åŠ æ–™: ${displayToppings.join(', ')}</div>`;
          }

          orderItemEl.innerHTML = `
                <div class="order-item-header">
                    <span class="order-item-name">${item.beverage.name} (${item.size})</span>
                    <span class="order-item-price">$${item.price}</span>
                </div>
                <div class="order-item-details">
                    <span>${optionsText}</span>
                    <div class="quantity-controls">
                        <button class="quantity-btn" onclick="changeQuantity(${index}, -1)">âˆ’</button>
                        <span class="quantity-display">${item.quantity}</span>
                        <button class="quantity-btn" onclick="changeQuantity(${index}, 1)">+</button>
                    </div>
                </div>
                ${toppingsText}
            `;

          return orderItemEl;
        }

        // æ”¹è®Šæ•¸é‡
        function changeQuantity(index, change) {
          const item = currentOrder[index];
          item.quantity += change;

          if (item.quantity <= 0) {
            currentOrder.splice(index, 1);
          } else {
            // é‡æ–°è¨ˆç®—åƒ¹æ ¼
            const basePrice = item.beverage.prices[item.size];
            let toppingsPrice = 0;
            if (item.toppings) {
              item.toppings.forEach(toppingName => {
                const topping = toppings.find(t => t.name === toppingName);
                if (topping) {
                  toppingsPrice += topping.price;
                }
              });
            }
            item.price = (basePrice + toppingsPrice) * item.quantity;
          }

          updateOrderDisplay();
          updateOrderPreview();
        }

        // æ›´æ–°è¨‚å–®é è¦½
        function updateOrderPreview() {
          const name = customerName.value.trim();
          const phone = customerPhone.value.trim();
          const address = deliveryAddress.value.trim();
          const time = deliveryTime.value;
          const timeUnit = deliveryTimeUnit.value;

          if (!name || !phone || !address || !time || currentOrder.length === 0) {
            orderPreview.textContent = 'è«‹å…ˆå¡«å¯«å®Œæ•´çš„è¨‚è³¼è³‡è¨Šå’Œé¸æ“‡é£²å“...';
            copyOrderBtn.disabled = true;
            sendOrderBtn.disabled = true;
            return;
          }

          const total = currentOrder.reduce((sum, item) => sum + item.price, 0);
          const orderTime = new Date().toLocaleString('zh-TW');

          // çµ„åˆæ™‚é–“å’Œå–®ä½é¡¯ç¤º
          let deliveryTimeText = time;
          if (time && timeUnit) {
            deliveryTimeText = `${time}${timeUnit}`;
          }

          let previewText = `ğŸ§‹ åŠŸå¤«èŒ¶ KUNG FU TEA è¨‚å–®\n`;
          previewText += `================\n`;
          previewText += `ğŸ“… è¨‚è³¼æ™‚é–“ï¼š${orderTime}\n`;
          previewText += `ğŸ‘¤ è¨‚è³¼äººï¼š${name}\n`;
          previewText += `ğŸ“ è¯çµ¡é›»è©±ï¼š${phone}\n`;
          previewText += `ğŸ“ å¤–é€åœ°å€ï¼š${address}\n`;
          previewText += `â° å¸Œæœ›é€é”æ™‚é–“ï¼š${deliveryTimeText}\n`;
          previewText += `================\n`;
          previewText += `ğŸ“‹ è¨‚è³¼å…§å®¹ï¼š\n\n`;

          currentOrder.forEach((item, index) => {
            let orderLine = `${index + 1}. ${item.beverage.name} ${item.size}`;

            // æ·»åŠ èŒ¶å“ç”œåº¦å†°å¡Šè³‡è¨Š
            const options = [];
            if (item.tea) options.push(item.tea);
            if (item.sugar) options.push(item.sugar);
            if (item.ice) options.push(item.ice);
            if (options.length > 0) {
              orderLine += ` ${options.join('')}`;
            }

            // æ·»åŠ åŠ æ–™è³‡è¨Š
            if (item.toppings && item.toppings.length > 0) {
              const displayToppings = item.toppings.map(toppingName => {
                const topping = toppings.find(t => t.name === toppingName);
                return topping ? topping.displayName : toppingName;
              });
              orderLine += ` +${displayToppings.join('+')}`;
            }

            orderLine += ` Ã—${item.quantity} è¨ˆï¼š${item.price}`;
            previewText += orderLine + '\n';
          });

          previewText += `\n================\n`;

          // æ·»åŠ å…é‹æ¢ä»¶å’Œé‹è²»ä¿¡æ¯
          const deliveryLevel = getCurrentDeliveryLevel();
          if (deliveryLevel) {
            const freeShippingAmount = deliveryLevel.freeShipping;
            const deliveryFee = deliveryLevel.fee;

            if (total >= freeShippingAmount) {
              // å·²é”æˆå…é‹æ¢ä»¶
              previewText += `ğŸ‰ å…é‹æ¢ä»¶ï¼šå·²é”æˆ (æ»¿$${freeShippingAmount}å…é‹)\n`;
              previewText += `ğŸ’° è¨‚å–®é‡‘é¡ï¼š$${total}\n`;
              previewText += `ğŸšš é‹è²»ï¼šå…é‹ âœ“\n`;
              previewText += `ğŸ’³ ç¸½è¨ˆï¼š$${total}\n`;
            } else {
              // æœªé”æˆå…é‹æ¢ä»¶
              const remainingAmount = freeShippingAmount - total;
              previewText += `ğŸ“Š å…é‹æ¢ä»¶ï¼šæ»¿$${freeShippingAmount}å…é‹\n`;
              previewText += `ğŸ’° è¨‚å–®é‡‘é¡ï¼š$${total}\n`;
              previewText += `ğŸ¯ é‚„å·®ï¼š$${remainingAmount} é”æˆå…é‹\n`;
              previewText += `ğŸšš é‹è²»ï¼š$${deliveryFee}\n`;
              previewText += `ğŸ’³ ç¸½è¨ˆï¼š$${total + deliveryFee}\n`;
            }
          } else {
            // æ²’æœ‰å¤–é€åœ°å€ä¿¡æ¯
            previewText += `ğŸ’° è¨‚å–®é‡‘é¡ï¼š$${total}\n`;
            previewText += `âš ï¸ è«‹å¡«å¯«å¤–é€åœ°å€ä»¥æŸ¥çœ‹é‹è²»è³‡è¨Š\n`;
          }

          previewText += `================\n`;
          previewText += `\nè¬è¬åº—å®¶ éº»ç…©å¹«æˆ‘${deliveryTimeText}é€é” ğŸ™`;
          previewText += `\n\n================`;
          previewText += `\nğŸ“¢ é‡è¦æé†’ï¼š`;
          previewText += `\nâ€¢ ç™¼é€æ­¤è¨‚å–®è¨Šæ¯å¾Œï¼Œè«‹ç«‹å³æ’¥æ‰“å®˜æ–¹LINEç¢ºèª`;
          previewText += `\nâ€¢ ç¢ºèªåº—å®¶æ”¶åˆ°è¨‚å–®ä¸¦å›è¦†å¾Œï¼Œæ‰ç®—è¨‚è³¼æˆåŠŸ`;
          previewText += `\nâ€¢ å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹ç›´æ¥è¯ç¹«åº—å®¶`;
          previewText += `\nâ€¢ æ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼Œç¥æ‚¨ç”¨é¤æ„‰å¿«ï¼`;

          orderPreview.textContent = previewText;
          copyOrderBtn.disabled = false;
          sendOrderBtn.disabled = false;
        }

        // è¤‡è£½è¨‚å–®æ–‡å­—
        copyOrderBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(orderPreview.textContent);
            copyOrderBtn.textContent = 'âœ… å·²è¤‡è£½ï¼';
            setTimeout(() => {
              copyOrderBtn.textContent = 'ğŸ“‹ è¤‡è£½è¨‚å–®æ–‡å­—å¾Œé»æ“Šä¸‹æ–¹â†“';
            }, 2000);
          } catch (err) {
            // å‚™ç”¨è¤‡è£½æ–¹æ³•
            const textArea = document.createElement('textarea');
            textArea.value = orderPreview.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);

            copyOrderBtn.textContent = 'âœ… å·²è¤‡è£½ï¼';
            setTimeout(() => {
              copyOrderBtn.textContent = 'ğŸ“‹ è¤‡è£½è¨‚å–®æ–‡å­—å¾Œé»æ“Šä¸‹æ–¹â†“';
            }, 2000);
          }
        };

        function buildBackendOrderPayload() {
          const name = customerName.value.trim();
          const phone = customerPhone.value.trim();
          const address = deliveryAddress.value.trim();
          const notes = `å¸Œæœ›é€é”æ™‚é–“ï¼š${deliveryTime.value}${deliveryTimeUnit.value}`;
          const subtotal = currentOrder.reduce((sum, item) => sum + Number(item.price || 0), 0);
          const deliveryLevel = getCurrentDeliveryLevel();
          const deliveryFee = deliveryLevel && subtotal < deliveryLevel.freeShipping ? deliveryLevel.fee : 0;
          const total = subtotal + deliveryFee;

          const items = currentOrder.map(item => {
            const quantity = Number(item.quantity || 1);
            const lineTotal = Number(item.price || 0);
            const unitPrice = quantity > 0 ? Math.round(lineTotal / quantity) : lineTotal;
            const optionParts = [item.sugar, item.ice, item.tea].filter(Boolean);
            if (item.toppings && item.toppings.length > 0) {
              optionParts.push(`åŠ æ–™:${item.toppings.join('+')}`);
            }
            const optionText = optionParts.length ? `ï¼ˆ${optionParts.join(' / ')}ï¼‰` : '';

            return {
              name: `${item.beverage.name}${optionText}`,
              size: item.size || 'L',
              price: unitPrice,
              quantity: quantity,
              total: lineTotal
            };
          });

          return {
            customer: {
              name,
              phone,
              method: 'delivery',
              address,
              notes
            },
            items,
            total,
            status: 'pending'
          };
        }

        // é€å–®åˆ°å¾Œå°ï¼ˆå…±ç”¨ï¼šPOST ä¸¦å›å‚³çµæœï¼‰
        async function syncOrderToBackend() {
          const response = await fetch(`${BACKEND_API_URL}/orders`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(buildBackendOrderPayload())
          });
          const result = await response.json();
          if (!response.ok || !result.success) {
            throw new Error(result.message || `HTTP ${response.status}`);
          }
          return result;
        }

        // ç™¼é€çµ¦ LINE å®˜æ–¹ï¼ˆèƒŒæ™¯åŒæ­¥å¾Œå°ï¼Œä¸é¡¯ç¤ºåŒæ­¥æˆåŠŸæç¤ºï¼‰
        sendOrderBtn.onclick = async () => {
          if (currentOrder.length === 0) {
            showCuteAlert('è¨‚å–®ç‚ºç©ºï¼', 'è«‹å…ˆåŠ å…¥é£²å“å†é€å‡ºè¨‚å–®ï½', 'ğŸ“');
            return;
          }
          if (!checkOrderInfo()) return;

          const originalText = sendOrderBtn.textContent;
          sendOrderBtn.disabled = true;
          sendOrderBtn.textContent = 'â³ é–‹å•Ÿä¸­...';

          try {
            await syncOrderToBackend();
          } catch (error) {
            showCuteAlert('å¾Œå°åŒæ­¥å¤±æ•—', `ç„¡æ³•åŒæ­¥åˆ°å¾Œå°ï¼š${error.message}\nä»æœƒé–‹å•Ÿ LINE é€å–®ã€‚`, 'âš ï¸');
          } finally {
            sendOrderBtn.disabled = false;
            sendOrderBtn.textContent = originalText;
          }

          const orderText = encodeURIComponent(orderPreview.textContent);
          const lineUrl = `https://lin.ee/QmyIa34?text=${orderText}`;
          window.open(lineUrl, '_blank');
        };

        // å„²å­˜è¨‚å–®
        saveOrderBtn.onclick = () => {
          if (currentOrder.length === 0) {
            showCuteAlert(
              'è¨‚å–®ç‚ºç©ºï¼',
              'è¨‚å–®æ˜¯ç©ºçš„ï¼Œç„¡æ³•å„²å­˜å“¦ï½',
              'ğŸ“'
            );
            return;
          }

          const name = customerName.value.trim();
          const phone = customerPhone.value.trim();
          const address = deliveryAddress.value.trim();
          const time = deliveryTime.value;
          const timeUnit = deliveryTimeUnit.value;

          if (!name || !phone || !address || !time) {
            showCuteAlert(
              'è«‹å…ˆå¡«å¯«è¨‚è³¼è³‡è¨Šï¼',
              'è«‹å…ˆå¡«å¯«å®Œæ•´çš„è¨‚è³¼è³‡è¨Šå¾Œå†å„²å­˜å“¦ï½',
              'ğŸ“‹'
            );
            return;
          }

          const orderData = {
            id: Date.now(),
            name: name,
            phone: phone,
            address: address,
            deliveryTime: time,
            deliveryTimeUnit: timeUnit,
            items: [...currentOrder],
            total: currentOrder.reduce((sum, item) => sum + item.price, 0),
            saveTime: new Date().toLocaleString('zh-TW')
          };

          // æª¢æŸ¥æ˜¯å¦è¶…é10å€‹è¨‚å–®
          if (savedOrders.length >= 10) {
            if (confirm('å·²å„²å­˜10å€‹è¨‚å–®ï¼Œæ˜¯å¦è¦è¦†è“‹æœ€èˆŠçš„è¨‚å–®ï¼Ÿ')) {
              savedOrders.shift(); // ç§»é™¤æœ€èˆŠçš„è¨‚å–®
            } else {
              return;
            }
          }

          savedOrders.push(orderData);
          localStorage.setItem('kungfuTeaOrders', JSON.stringify(savedOrders));

          showCuteAlert(
            'å„²å­˜æˆåŠŸï¼',
            `è¨‚å–®å·²å„²å­˜ï¼\nè¨‚å–®ç·¨è™Ÿ: ${orderData.id}\nå„²å­˜æ™‚é–“: ${orderData.saveTime}`,
            'âœ…'
          );
          updateLoadOrdersButton();
        };

        // è¼‰å…¥è¨‚å–®åˆ—è¡¨
        loadOrdersBtn.onclick = () => {
          if (savedOrders.length === 0) {
            showCuteAlert(
              'æ²’æœ‰å„²å­˜çš„è¨‚å–®ï¼',
              'ç›®å‰æ²’æœ‰å„²å­˜çš„è¨‚å–®å“¦ï½',
              'ğŸ“­'
            );
            return;
          }

          // å‰µå»ºè¨‚å–®é¸æ“‡æ¨¡æ…‹æ¡†
          const orderModal = document.createElement('div');
          orderModal.className = 'modal';
          orderModal.style.display = 'block';
          orderModal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <h3 class="modal-title">é¸æ“‡è¦è¼‰å…¥çš„è¨‚å–®</h3>
                    <div class="orders-list" style="max-height: 400px; overflow-y: auto;">
                        ${savedOrders.map((order, index) => `
                            <div class="order-item-select" data-order-id="${order.id}">
                                <div class="order-item-header">
                                    <span>è¨‚å–® #${order.id}</span>
                                    <span class="price">$${order.total}</span>
                                </div>
                                <div class="order-item-details">
                                    <div>
                                        <strong>${order.name}</strong><br>
                                        ğŸ“ ${order.phone}<br>
                                        ğŸ“ ${order.address}
                                    </div>
                                    <div class="order-actions">
                                        <button class="btn btn-primary load-order-btn" data-order-id="${order.id}">è¼‰å…¥</button>
                                        <button class="btn btn-secondary delete-order-btn" data-order-id="${order.id}">åˆªé™¤</button>
                                    </div>
                                </div>
                                <div style="color: var(--kt-text-muted); font-size: 0.8rem; margin-top: 5px;">
                                    å„²å­˜æ™‚é–“: ${order.saveTime}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="modal-buttons">
                        <button class="btn btn-secondary" id="clear-all-orders">æ¸…ç©ºæ‰€æœ‰è¨‚å–®</button>
                        <button class="btn btn-secondary" id="close-orders-modal">é—œé–‰</button>
                    </div>
                </div>
            `;

          document.body.appendChild(orderModal);

          // æ·»åŠ æ¨£å¼
          const style = document.createElement('style');
          style.textContent = `
                .order-item-select {
                    background: #f8f9ff;
                    border: 1px solid var(--kt-border);
                    border-radius: 10px;
                    padding: 15px;
                    margin-bottom: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                }
                .order-item-select:hover {
                    border-color: var(--kt-primary);
                    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
                }
                .order-actions {
                    display: flex;
                    gap: 8px;
                }
                .order-actions .btn {
                    padding: 8px 12px;
                    font-size: 0.9rem;
                }
            `;
          document.head.appendChild(style);

          // è¼‰å…¥è¨‚å–®
          orderModal.querySelectorAll('.load-order-btn').forEach(btn => {
            btn.onclick = (e) => {
              e.stopPropagation();
              const orderId = parseInt(btn.dataset.orderId);
              const order = savedOrders.find(order => order.id === orderId);
              if (order) {
                customerName.value = order.name;
                customerPhone.value = order.phone;
                deliveryAddress.value = order.address;
                deliveryTime.value = order.deliveryTime || '';
                deliveryTimeUnit.value = order.deliveryTimeUnit || 'æ•´';
                currentOrder = [...order.items];
                updateOrderDisplay();
                updateOrderPreview();
                document.body.removeChild(orderModal);
                document.head.removeChild(style);
                showCuteAlert(
                  'è¼‰å…¥æˆåŠŸï¼',
                  'è¨‚å–®å·²è¼‰å…¥ï¼',
                  'ğŸ‰'
                );
              }
            };
          });

          // åˆªé™¤è¨‚å–®
          orderModal.querySelectorAll('.delete-order-btn').forEach(btn => {
            btn.onclick = (e) => {
              e.stopPropagation();
              if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¨‚å–®å—ï¼Ÿ')) {
                const orderId = parseInt(btn.dataset.orderId);
                const orderIndex = savedOrders.findIndex(order => order.id === orderId);
                if (orderIndex !== -1) {
                  savedOrders.splice(orderIndex, 1);
                  localStorage.setItem('kungfuTeaOrders', JSON.stringify(savedOrders));
                  // é‡æ–°è¼‰å…¥æ¨¡æ…‹æ¡†
                  document.body.removeChild(orderModal);
                  document.head.removeChild(style);
                  loadOrdersBtn.click();
                }
              }
            };
          });

          // æ¸…ç©ºæ‰€æœ‰è¨‚å–®
          orderModal.querySelector('#clear-all-orders').onclick = () => {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å„²å­˜çš„è¨‚å–®å—ï¼Ÿ')) {
              savedOrders = [];
              localStorage.setItem('kungfuTeaOrders', JSON.stringify(savedOrders));
              document.body.removeChild(orderModal);
              document.head.removeChild(style);
              updateLoadOrdersButton();
              showCuteAlert(
                'æ¸…ç©ºå®Œæˆï¼',
                'æ‰€æœ‰è¨‚å–®å·²æ¸…ç©ºï¼',
                'ğŸ—‘ï¸'
              );
            }
          };

          // é—œé–‰æ¨¡æ…‹æ¡†
          orderModal.querySelector('#close-orders-modal').onclick = () => {
            document.body.removeChild(orderModal);
            document.head.removeChild(style);
          };

          // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
          orderModal.onclick = (e) => {
            if (e.target === orderModal) {
              document.body.removeChild(orderModal);
              document.head.removeChild(style);
            }
          };
        };

        // æ›´æ–°è¼‰å…¥è¨‚å–®æŒ‰éˆ•æ–‡å­—
        function updateLoadOrdersButton() {
          loadOrdersBtn.textContent = `ğŸ“‹ è¼‰å…¥è¨‚å–® (${savedOrders.length}/10)`;
        }

        // æ¸…ç©ºè¨‚å–®
        clearOrderBtn.onclick = () => {
          if (currentOrder.length === 0) return;

          if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨‚å–®é …ç›®å—ï¼Ÿ')) {
            currentOrder = [];
            updateOrderDisplay();
            updateOrderPreview();
          }
        };

        // ç›£è½è¨‚è³¼è³‡è¨Šè¼¸å…¥è®ŠåŒ–
        [customerName, customerPhone, deliveryAddress, deliveryTime, deliveryTimeUnit].forEach(input => {
          input.addEventListener('input', function () {
            // æ¸…é™¤é«˜äº®æ•ˆæœ
            this.style.borderColor = 'var(--kt-border)';
            updateOrderPreview();
          });
        });

        // æ™‚é–“é©—è­‰å‡½æ•¸
        function validateDeliveryTime() {
          const timeValue = deliveryTime.value;
          if (timeValue) {
            const [hours, minutes] = timeValue.split(':').map(Number);
            const timeInMinutes = hours * 60 + minutes;
            const minTime = 10 * 60; // 10:00
            const maxTime = 17 * 60; // 17:00

            if (timeInMinutes < minTime || timeInMinutes > maxTime) {
              deliveryTime.style.borderColor = '#ff6b6b';
              showCuteAlert(
                'æ™‚é–“è¶…å‡ºç¯„åœï¼',
                'é€é”æ™‚é–“åªèƒ½åœ¨ 10:00 - 17:00 ä¹‹é–“å“¦ï½',
                'â°'
              );
              deliveryTime.value = '';
              return false;
            }
          }
          return true;
        }

        // ç›£è½æ™‚é–“é¸æ“‡å™¨è®ŠåŒ–
        deliveryTime.addEventListener('change', function () {
          if (this.value && !validateDeliveryTime()) {
            return;
          }
          this.style.borderColor = 'var(--kt-border)';
          updateOrderPreview();
        });

        // ç›£è½æ™‚é–“é¸æ“‡å™¨å¤±å»ç„¦é»
        deliveryTime.addEventListener('blur', function () {
          if (this.value && !validateDeliveryTime()) {
            return;
          }
          this.style.borderColor = 'var(--kt-border)';
        });

        // é™åˆ¶æ•¸é‡è¼¸å…¥æ¡†åªèƒ½è¼¸å…¥æ•¸å­—
        quantityInput.addEventListener('input', function (e) {
          // ç§»é™¤æ‰€æœ‰éæ•¸å­—å­—ç¬¦
          this.value = this.value.replace(/[^0-9]/g, '');
          // ç¢ºä¿æœ€å°å€¼ç‚º1
          if (this.value < 1) {
            this.value = 1;
          }
        });

        // é˜²æ­¢ç²˜è²¼éæ•¸å­—å…§å®¹
        quantityInput.addEventListener('paste', function (e) {
          e.preventDefault();
          const paste = (e.clipboardData || window.clipboardData).getData('text');
          const numbers = paste.replace(/[^0-9]/g, '');
          if (numbers) {
            this.value = Math.max(1, parseInt(numbers) || 1);
          }
        });

        // æ•¸é‡ Â± æŒ‰éˆ•ï¼ˆæ‰‹æ©Ÿç‰ˆå¥½æŒ‰ï¼‰
        document.getElementById('quantity-minus').addEventListener('click', function () {
          const n = Math.max(1, (parseInt(quantityInput.value) || 1) - 1);
          quantityInput.value = n;
        });
        document.getElementById('quantity-plus').addEventListener('click', function () {
          const n = (parseInt(quantityInput.value) || 1) + 1;
          quantityInput.value = n;
        });

        // è¨­ç½®é¸é …æŒ‰éˆ•é»æ“Šäº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
          // ç”œåº¦é¸é …
          document.querySelectorAll('#sugar-options .option-btn').forEach(btn => {
            btn.onclick = () => selectOption(btn, 'sugar');
          });

          // å†°å¡Šé¸é …
          document.querySelectorAll('#ice-options .option-btn').forEach(btn => {
            btn.onclick = () => selectOption(btn, 'ice');
          });
        });

        // å¤–é€é‡‘é¡æŸ¥è©¢åŠŸèƒ½
        const deliveryFeeData = [
          { distance: "2å…¬é‡Œä»¥å…§", fee: 30, freeShipping: 240, minOrder: 120 },
          { distance: "3å…¬é‡Œä»¥å…§", fee: 45, freeShipping: 360, minOrder: 180 },
          { distance: "4å…¬é‡Œä»¥å…§", fee: 60, freeShipping: 480, minOrder: 240 },
          { distance: "5å…¬é‡Œä»¥å…§", fee: 75, freeShipping: 600, minOrder: 300 },
          { distance: "6å…¬é‡Œä»¥å…§", fee: 90, freeShipping: 720, minOrder: 360 },
          { distance: "7å…¬é‡Œä»¥å…§", fee: 105, freeShipping: 840, minOrder: 420 },
          { distance: "8å…¬é‡Œä»¥å…§", fee: 120, freeShipping: 960, minOrder: 480 },
          { distance: "9å…¬é‡Œä»¥å…§", fee: 135, freeShipping: 1080, minOrder: 540 },
          { distance: "10å…¬é‡Œä»¥å…§", fee: 150, freeShipping: 1200, minOrder: 600 },
          { distance: "11å…¬é‡Œä»¥å…§", fee: 165, freeShipping: 1320, minOrder: 660 },
          { distance: "12å…¬é‡Œä»¥å…§", fee: 180, freeShipping: 1440, minOrder: 720 },
          { distance: "13å…¬é‡Œä»¥å…§", fee: 195, freeShipping: 1560, minOrder: 780 },
          { distance: "14å…¬é‡Œä»¥å…§", fee: 210, freeShipping: 1680, minOrder: 840 },
          { distance: "15å…¬é‡Œä»¥å…§", fee: 225, freeShipping: 1800, minOrder: 900 },
          { distance: "16å…¬é‡Œä»¥å…§", fee: 240, freeShipping: 1920, minOrder: 960 },
          { distance: "17å…¬é‡Œä»¥å…§", fee: 255, freeShipping: 2040, minOrder: 1020 },
          { distance: "18å…¬é‡Œä»¥å…§", fee: 270, freeShipping: 2160, minOrder: 1080 },
          { distance: "19å…¬é‡Œä»¥å…§", fee: 285, freeShipping: 2280, minOrder: 1140 },
          { distance: "20å…¬é‡Œä»¥å…§", fee: 300, freeShipping: 2400, minOrder: 1200 }
        ];

        // å¯ç”±å¤–éƒ¨æ³¨å…¥ window.KUNGFU_TEA_SERPAPI_KEY è¦†è“‹é è¨­å€¼
        const SERPAPI_KEY = (window.KUNGFU_TEA_SERPAPI_KEY || 'ceb2e0ccd89ad2ac2a04b01fe2a2185d8a0b268e5bd37256f5f6b8427c532a58').trim();

        // ç”Ÿæˆå¤–é€é‡‘é¡è¡¨æ ¼
        function generateDeliveryFeeTable() {
          const tbody = document.getElementById('delivery-fee-tbody');
          tbody.innerHTML = '';

          // æª¢æŸ¥æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ
          const isMobile = window.innerWidth <= 768;

          if (isMobile) {
            // æ‰‹æ©Ÿç‰ˆï¼šä½¿ç”¨å¡ç‰‡å¼é¡¯ç¤º
            tbody.innerHTML = `
              <tr>
                <td colspan="4" style="padding: 0; border: none;">
                  <div style="display: grid; gap: 8px; padding: 10px;">
                    ${deliveryFeeData.map((item, index) => `
                      <div style="background: ${index % 2 === 0 ? '#ffffff' : '#f8f9ff'}; border: 1px solid #ddd; border-radius: 6px; padding: 8px; display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 0.7rem;">
                        <div style="font-weight: bold; color: var(--kt-text); white-space: nowrap;">${item.distance}</div>
                        <div style="text-align: right; color: #e74c3c; font-weight: bold; white-space: nowrap;">$${item.fee}</div>
                        <div style="color: #27ae60; font-weight: bold; white-space: nowrap;">å…é‹: $${item.freeShipping}</div>
                        <div style="text-align: right; color: var(--kt-primary); font-weight: bold; white-space: nowrap;">æœ€ä½: $${item.minOrder}</div>
                      </div>
                    `).join('')}
                  </div>
                </td>
              </tr>
            `;
          } else {
            // æ¡Œé¢ç‰ˆï¼šä½¿ç”¨è¡¨æ ¼é¡¯ç¤º
            deliveryFeeData.forEach((item, index) => {
              const row = document.createElement('tr');
              row.style.backgroundColor = index % 2 === 0 ? '#ffffff' : '#f8f9ff';
              row.innerHTML = `
                <td style="padding: 4px 3px; border: 1px solid #ddd; text-align: center; font-weight: bold; font-size: 0.65rem;">${item.distance}</td>
                <td style="padding: 4px 3px; border: 1px solid #ddd; text-align: center; color: #e74c3c; font-weight: bold; font-size: 0.65rem;">$${item.fee}</td>
                <td style="padding: 4px 3px; border: 1px solid #ddd; text-align: center; color: #27ae60; font-weight: bold; font-size: 0.65rem;">$${item.freeShipping}</td>
                <td style="padding: 4px 3px; border: 1px solid #ddd; text-align: center; color: var(--kt-primary); font-weight: bold; font-size: 0.65rem;">$${item.minOrder}</td>
              `;
              tbody.appendChild(row);
            });
          }
        }

        // åˆ‡æ›å¤–é€é‡‘é¡æŸ¥è©¢é¡¯ç¤º
        function toggleDeliveryFee() {
          const content = document.getElementById('delivery-fee-content');
          const button = document.getElementById('toggle-delivery-fee');

          if (!content || !button) {
            return;
          }

          if (content.style.display === 'none') {
            content.style.display = 'block';
            button.textContent = 'ğŸ“‹ éš±è—æŸ¥è©¢è¡¨';
            generateDeliveryFeeTable();
          } else {
            content.style.display = 'none';
            button.textContent = 'ğŸ“‹ é¡¯ç¤ºæŸ¥è©¢è¡¨';
          }
        }

        // ç¶å®šåˆ‡æ›æŒ‰éˆ•äº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
          const toggleBtn = document.getElementById('toggle-delivery-fee');
          if (toggleBtn) {
            toggleBtn.addEventListener('click', toggleDeliveryFee);
          }

          // ç›£è½è¦–çª—å¤§å°æ”¹è®Šï¼Œé‡æ–°ç”Ÿæˆè¡¨æ ¼
          window.addEventListener('resize', () => {
            const content = document.getElementById('delivery-fee-content');
            if (content && content.style.display !== 'none') {
              generateDeliveryFeeTable();
            }
          });

          // ç¶å®šæ¨¡æ…‹æ¡†æŒ‰éˆ•äº‹ä»¶
          if (addToOrderBtn) {
            addToOrderBtn.addEventListener('click', addToOrder);
          }
          if (cancelOrderBtn) {
            cancelOrderBtn.addEventListener('click', closeOrderModal);
          }

          // é»æ“Šæ¨¡æ…‹æ¡†èƒŒæ™¯é—œé–‰
          if (modal) {
            modal.addEventListener('click', (e) => {
              if (e.target === modal) {
                closeOrderModal();
              }
            });
          }
        });

        // è·é›¢è¨ˆç®—åŠŸèƒ½
        const storeAddress = "å››ç¶­è·¯90è™Ÿ, æ¥Šæ¢…å€, æ¡ƒåœ’å¸‚, å°ç£";
        let distanceCalculationTimeout;
        let googleMapsLoaded = false;

        // ä½¿ç”¨ SerpApi Google Maps Directions API è¨ˆç®—è·é›¢
        async function calculateDistanceWithGoogleMaps(customerAddress) {
          console.log('é–‹å§‹ SerpApi è·é›¢è¨ˆç®—:', customerAddress);

          try {
            if (!SERPAPI_KEY) {
              console.warn('è«‹å…ˆè¨­å®š SerpApi API Keyï¼Œä½¿ç”¨å‚™ç”¨è¨ˆç®—æ–¹æ³•');
              return useBackupDistanceCalculation(customerAddress);
            }

            console.log('æ­£åœ¨ä½¿ç”¨ SerpApi è¨ˆç®—è·é›¢...');

            // æ§‹å»º SerpApi è«‹æ±‚åƒæ•¸
            const params = new URLSearchParams({
              engine: 'google_maps_directions',
              start_addr: storeAddress,
              end_addr: customerAddress,
              api_key: SERPAPI_KEY,
              hl: 'zh-tw',  // ç¹é«”ä¸­æ–‡
              gl: 'tw'      // å°ç£åœ°å€
            });

            const response = await fetch(`https://serpapi.com/search.json?${params}`);

            if (!response.ok) {
              throw new Error(`SerpApi è«‹æ±‚å¤±æ•—: ${response.status}`);
            }

            const data = await response.json();
            console.log('SerpApi éŸ¿æ‡‰:', data);

            // æª¢æŸ¥æ˜¯å¦æœ‰è·¯å¾‘ä¿¡æ¯
            if (data.directions && data.directions.length > 0) {
              const direction = data.directions[0];

              // ç²å–è·é›¢ä¿¡æ¯
              let distanceKm = null;
              if (typeof direction.distance === 'number') {
                // SerpApi é€šå¸¸å›å‚³å…¬å°º
                distanceKm = direction.distance / 1000;
              } else if (typeof direction.formatted_distance === 'string') {
                const distanceMatch = direction.formatted_distance.match(/(\d+\.?\d*)/);
                if (distanceMatch) {
                  distanceKm = parseFloat(distanceMatch[1]);
                }
              } else if (typeof direction.distance === 'string') {
                const distanceMatch = direction.distance.match(/(\d+\.?\d*)/);
                if (distanceMatch) {
                  distanceKm = parseFloat(distanceMatch[1]);
                }
              }

              // ç²å–æ™‚é–“ä¿¡æ¯
              let durationText = '';
              if (typeof direction.formatted_duration === 'string') {
                durationText = direction.formatted_duration;
              } else if (typeof direction.duration === 'number') {
                durationText = `${Math.round(direction.duration / 60)} åˆ†`;
              }

              if (distanceKm) {
                console.log('SerpApi è¨ˆç®—è·é›¢:', distanceKm, 'å…¬é‡Œ');
                console.log('SerpApi è¨ˆç®—æ™‚é–“:', durationText);

                // é¡¯ç¤ºçµæœï¼ˆåŒ…å«æ™‚é–“ä¿¡æ¯ï¼‰
                displayDistanceResultWithDuration(distanceKm, durationText, true);
                return;
              }
            }

            // å¦‚æœæ²’æœ‰è·¯å¾‘ä¿¡æ¯ï¼Œå˜—è©¦ä½¿ç”¨ Google Maps æœç´¢
            console.log('å˜—è©¦ä½¿ç”¨ Google Maps æœç´¢...');
            await searchWithGoogleMaps(customerAddress);

          } catch (error) {
            console.warn('SerpApi è·é›¢è¨ˆç®—å¤±æ•—:', error);
            // å¦‚æœ SerpApi è¨ˆç®—å¤±æ•—ï¼Œä½¿ç”¨å‚™ç”¨æ–¹æ³•
            useBackupDistanceCalculation(customerAddress);
          }
        }

        // ä½¿ç”¨ SerpApi Google Maps æœç´¢åŠŸèƒ½
        async function searchWithGoogleMaps(customerAddress) {
          try {
            if (!SERPAPI_KEY) {
              throw new Error('API Key æœªè¨­å®š');
            }

            // ä½¿ç”¨ Google Maps æœç´¢
            const params = new URLSearchParams({
              engine: 'google_maps',
              q: customerAddress,
              ll: '@24.913547308670775,121.18078338776571,14z', // åº—å®¶ç²¾ç¢ºåº§æ¨™
              api_key: SERPAPI_KEY,
              hl: 'zh-tw',
              gl: 'tw'
            });

            const response = await fetch(`https://serpapi.com/search.json?${params}`);
            const data = await response.json();

            if (data.local_results && data.local_results.length > 0) {
              const result = data.local_results[0];
              console.log('Google Maps æœç´¢çµæœ:', result);

              // é€™è£¡å¯ä»¥é€²ä¸€æ­¥è™•ç†æœç´¢çµæœ
              // ä¾‹å¦‚ç²å–åº§æ¨™ä¸¦è¨ˆç®—è·é›¢
            }

          } catch (error) {
            console.warn('Google Maps æœç´¢å¤±æ•—:', error);
            throw error;
          }
        }

        // é¡¯ç¤ºåŒ…å«æ™‚é–“ä¿¡æ¯çš„è·é›¢è¨ˆç®—çµæœ
        function displayDistanceResultWithDuration(distanceKm, durationText, isGoogleMaps = false) {
          const distanceResult = document.getElementById('distance-result');
          const deliveryLevel = getDeliveryLevel(distanceKm);

          const sourceText = isGoogleMaps ? 'Google Maps ç²¾ç¢ºè¨ˆç®—' : 'ç³»çµ±ä¼°ç®—';

          // æ ¼å¼åŒ–è·é›¢é¡¯ç¤ºï¼ˆä¿ç•™å°æ•¸é»å¾Œ1ä½ï¼‰
          const formattedDistance = distanceKm.toFixed(1);

          // è¨ˆç®—é‹è²»
          const deliveryFee = getDeliveryFee(distanceKm);

          // è¨ˆç®—é è¨ˆé€é”æ™‚é–“ï¼ˆåŸºæ–¼è·é›¢ï¼‰
          const estimatedDeliveryTime = calculateEstimatedDeliveryTime(distanceKm);

          distanceResult.innerHTML = `
            <div class="distance-display">
              <span class="distance-icon">ğŸ“</span>
              <span class="distance-text">è·é›¢åº—å®¶: <span class="distance-value">${formattedDistance}</span>å…¬é‡Œ (${sourceText})</span>
            </div>
            
            <!-- è©³ç´°è·é›¢ä¿¡æ¯ -->
            <div class="detailed-distance-info" style="margin: 8px 0; padding: 8px; background: rgba(0, 123, 255, 0.05); border-radius: 6px; font-size: 0.85rem;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span>ğŸ“ ç²¾ç¢ºè·é›¢:</span>
                <span style="font-weight: bold; color: #007bff;">${formattedDistance} å…¬é‡Œ</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span>ğŸšš é‹è²»:</span>
                <span style="font-weight: bold; color: #e74c3c;">$${deliveryFee}</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span>â±ï¸ é è¨ˆé€é”:</span>
                <span style="font-weight: bold; color: #28a745;">${estimatedDeliveryTime}</span>
              </div>
              ${durationText ? `
              <div style="display: flex; justify-content: space-between;">
                <span>ğŸ›£ï¸ è¡Œè»Šæ™‚é–“:</span>
                <span style="font-weight: bold; color: #6c757d;">${durationText}</span>
              </div>
              ` : ''}
            </div>
            
            <div class="delivery-level">
              <span class="level-icon">ğŸšš</span>
              <span class="level-text">å¤–é€ç´šåˆ¥: <span class="level-value ${deliveryLevel.levelClass}">${deliveryLevel.distance}</span></span>
            </div>
            <div class="free-shipping-info">
              <span class="free-icon">ğŸ’°</span>
              <span class="free-text">å…é‹æ¢ä»¶: <span class="free-shipping-value">æ»¿$${deliveryLevel.freeShipping}å…é‹</span></span>
            </div>
            
            <!-- å…é‹æé†’å€åŸŸ -->
            <div id="shipping-reminder" 
                 class="shipping-reminder" 
                 style="display: none; margin-top: 12px; padding: 12px; background: rgba(45, 90, 39, 0.06); border-radius: 14px; border-left: 4px solid var(--kt-primary);">
              <div id="shipping-reminder-content">
                <!-- å‹•æ…‹å…§å®¹å°‡åœ¨é€™è£¡é¡¯ç¤º -->
              </div>
            </div>
            
            ${!isGoogleMaps ? `
            <div style="margin-top: 8px; padding: 8px; background: rgba(255, 193, 7, 0.1); border-radius: 6px; font-size: 0.8rem; color: #856404;">
              âš ï¸ æ­¤ç‚ºä¼°ç®—è·é›¢ï¼Œå¯¦éš›è·é›¢è«‹ä»¥åº—å®¶ç¢ºèªç‚ºæº–
            </div>
            ` : `
            <div style="margin-top: 8px; padding: 8px; background: rgba(76, 175, 80, 0.1); border-radius: 6px; font-size: 0.8rem; color: #2e7d32;">
              âœ… æ­¤ç‚º Google Maps ç²¾ç¢ºè¨ˆç®—è·é›¢
            </div>
            `}
          `;
          distanceResult.style.display = 'block';

          // æ›´æ–°å…é‹æé†’
          updateShippingReminder(deliveryLevel);
        }

        // Haversine å…¬å¼è¨ˆç®—å…©é»é–“è·é›¢
        function calculateHaversineDistance(lat1, lon1, lat2, lon2) {
          const R = 6371; // åœ°çƒåŠå¾‘ï¼ˆå…¬é‡Œï¼‰
          const dLat = (lat2 - lat1) * Math.PI / 180;
          const dLon = (lon2 - lon1) * Math.PI / 180;
          const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
          const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
          return R * c;
        }

        // è¨ˆç®—é‹è²»
        function getDeliveryFee(distanceKm) {
          return getDeliveryLevel(distanceKm).fee;
        }

        // è¨ˆç®—é è¨ˆé€é”æ™‚é–“
        function calculateEstimatedDeliveryTime(distanceKm) {
          // åŸºç¤æº–å‚™æ™‚é–“ 15 åˆ†é˜ + æ¯å…¬é‡Œ 2 åˆ†é˜
          const baseTime = 15;
          const travelTime = Math.ceil(distanceKm * 2);
          const totalMinutes = baseTime + travelTime;

          const hours = Math.floor(totalMinutes / 60);
          const minutes = totalMinutes % 60;

          if (hours > 0) {
            return `${hours}å°æ™‚${minutes}åˆ†é˜`;
          } else {
            return `${minutes}åˆ†é˜`;
          }
        }

        // é¡¯ç¤ºè·é›¢è¨ˆç®—çµæœ
        function displayDistanceResult(distanceKm, isGoogleMaps = false) {
          const distanceResult = document.getElementById('distance-result');
          const deliveryLevel = getDeliveryLevel(distanceKm);

          const sourceText = isGoogleMaps ? 'Google Maps ç²¾ç¢ºè¨ˆç®—' : 'ç³»çµ±ä¼°ç®—';

          // æ ¼å¼åŒ–è·é›¢é¡¯ç¤ºï¼ˆä¿ç•™å°æ•¸é»å¾Œ1ä½ï¼‰
          const formattedDistance = distanceKm.toFixed(1);

          // è¨ˆç®—é‹è²»
          const deliveryFee = getDeliveryFee(distanceKm);

          // è¨ˆç®—é è¨ˆé€é”æ™‚é–“ï¼ˆåŸºæ–¼è·é›¢ï¼‰
          const estimatedDeliveryTime = calculateEstimatedDeliveryTime(distanceKm);

          distanceResult.innerHTML = `
            <div class="distance-display">
              <span class="distance-icon">ğŸ“</span>
              <span class="distance-text">è·é›¢åº—å®¶: <span class="distance-value">${formattedDistance}</span>å…¬é‡Œ (${sourceText})</span>
            </div>
            
            <!-- è©³ç´°è·é›¢ä¿¡æ¯ -->
            <div class="detailed-distance-info" style="margin: 8px 0; padding: 8px; background: rgba(0, 123, 255, 0.05); border-radius: 6px; font-size: 0.85rem;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span>ğŸ“ ç²¾ç¢ºè·é›¢:</span>
                <span style="font-weight: bold; color: #007bff;">${formattedDistance} å…¬é‡Œ</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span>ğŸšš é‹è²»:</span>
                <span style="font-weight: bold; color: #e74c3c;">$${deliveryFee}</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span>â±ï¸ é è¨ˆé€é”:</span>
                <span style="font-weight: bold; color: #28a745;">${estimatedDeliveryTime}</span>
              </div>
            </div>
            
            <div class="delivery-level">
              <span class="level-icon">ğŸšš</span>
              <span class="level-text">å¤–é€ç´šåˆ¥: <span class="level-value ${deliveryLevel.levelClass}">${deliveryLevel.distance}</span></span>
            </div>
            <div class="free-shipping-info">
              <span class="free-icon">ğŸ’°</span>
              <span class="free-text">å…é‹æ¢ä»¶: <span class="free-shipping-value">æ»¿$${deliveryLevel.freeShipping}å…é‹</span></span>
            </div>
            
            <!-- å…é‹æé†’å€åŸŸ -->
            <div id="shipping-reminder" 
                 class="shipping-reminder" 
                 style="display: none; margin-top: 12px; padding: 12px; background: rgba(45, 90, 39, 0.06); border-radius: 14px; border-left: 4px solid var(--kt-primary);">
              <div id="shipping-reminder-content">
                <!-- å‹•æ…‹å…§å®¹å°‡åœ¨é€™è£¡é¡¯ç¤º -->
              </div>
            </div>
            
            ${!isGoogleMaps ? `
            <div style="margin-top: 8px; padding: 8px; background: rgba(255, 193, 7, 0.1); border-radius: 6px; font-size: 0.8rem; color: #856404;">
              âš ï¸ æ­¤ç‚ºä¼°ç®—è·é›¢ï¼Œå¯¦éš›è·é›¢è«‹ä»¥åº—å®¶ç¢ºèªç‚ºæº–
            </div>
            ` : `
            <div style="margin-top: 8px; padding: 8px; background: rgba(76, 175, 80, 0.1); border-radius: 6px; font-size: 0.8rem; color: #2e7d32;">
              âœ… æ­¤ç‚º Google Maps ç²¾ç¢ºè¨ˆç®—è·é›¢
            </div>
            `}
          `;
          distanceResult.style.display = 'block';

          // æ›´æ–°å…é‹æé†’
          updateShippingReminder(deliveryLevel);
        }


        // åˆå§‹åŒ–è·é›¢è¨ˆç®—åŠŸèƒ½
        function initDistanceCalculation() {
          const deliveryAddressInput = document.getElementById('delivery-address');

          deliveryAddressInput.addEventListener('input', function () {
            const address = this.value.trim();
            clearTimeout(distanceCalculationTimeout);
            hideDistanceResult();

            if (address.length > 5) {
              // å»¶é²500mså¾Œè¨ˆç®—ï¼Œé¿å…é »ç¹èª¿ç”¨
              distanceCalculationTimeout = setTimeout(() => {
                // ä½¿ç”¨ SerpApi Google Maps Directions API è¨ˆç®—è·é›¢
                calculateDistanceWithGoogleMaps(address);
              }, 500);
            }
          });
        }

        // å‚™ç”¨è·é›¢è¨ˆç®—æ–¹æ³•ï¼ˆåŒ…å«ç‰¹å®šè·¯æ®µï¼‰
        function useBackupDistanceCalculation(customerAddress) {
          console.log('ä½¿ç”¨å‚™ç”¨è·é›¢è¨ˆç®—æ–¹æ³•:', customerAddress);

          // æ¥Šæ¢…å€ç‰¹å®šè·¯æ®µè·é›¢è¨­å®š
          const yangmeiSpecificRoutes = {
            'å¹¼ä¸‰è·¯': 4.7, 'å¹¼ç…è·¯': 4.7, 'å¹¼ç…å·¥æ¥­å€': 4.7,
            'å››ç¶­è·¯': 0.5, 'å¤§æˆè·¯': 1.2, 'æ–°æˆè·¯': 1.5,
            'æ°¸ç¾è·¯': 2.8, 'ä¸­å±±è·¯': 1.8, 'æ–‡åŒ–è¡—': 1.5,
            'æ¢…é«˜è·¯': 3.5, 'æ¢…ç…è·¯': 2.9, 'å¯Œå²¡': 5.2, 'æ¥Šæ¢…ç«è»Šç«™': 2.8,
            'ç‘åªè·¯': 3.8, 'é«˜æ¦®è·¯': 3.2, 'æ–°æ¦®è·¯': 2.8,
            'é‡‘é¾è·¯': 4.8, 'ç§€æ‰è·¯': 6.6, 'ä¸Šæ¹–è·¯': 6.2,
            'æ°´ç¾è·¯': 4.8, 'ä¸‰æ¹–è·¯': 5.8, 'é ­æ¹–è·¯': 6.5,
            'æ¥Šæ¹–è·¯': 4.2, 'ç‘åŸè·¯': 4.5, 'æ°¸æšè·¯': 3.8,
            'æ–°å¯Œè·¯': 5.2, 'å¯Œè±è·¯': 5.8, 'ç‘æºªè·¯': 4.8
          };

          // å¹³é®å€ç‰¹å®šè·¯æ®µè·é›¢è¨­å®š
          const pingzhenSpecificRoutes = {
            'å·¥æ¥­ä¸€è·¯': 4.5, 'å·¥æ¥­äºŒè·¯': 4.5, 'å·¥æ¥­ä¸‰è·¯': 4.5, 'å·¥æ¥­å››è·¯': 4.5,
            'å·¥æ¥­äº”è·¯': 4.5, 'å·¥æ¥­å…­è·¯': 4.5, 'å·¥æ¥­ä¸ƒè·¯': 4.5, 'å·¥æ¥­å…«è·¯': 4.5,
            'å·¥æ¥­ä¹è·¯': 4.5, 'å·¥æ¥­åè·¯': 4.5, 'å·¥æ¥­åä¸€è·¯': 4.5,
            'ä¸­è±è·¯': 5.5, 'ç’°å—è·¯': 6.8, 'æŒ¯èˆˆè·¯': 4.8,
            'å¾©èˆˆè¡—': 5.2, 'æ°‘æ—è·¯': 4.2, 'ä¸­æ­£è·¯': 5.8,
            'å»¶å¹³è·¯': 4.5, 'é‡‘é™µè·¯': 5.5, 'å»£æ³°è·¯': 6.8
          };

          // å…¶ä»–å€åŸŸè·é›¢ä¼°ç®—
          const areaEstimates = {
            'æ¥Šæ¢…': 3, 'ä¸­å£¢': 8, 'æ¡ƒåœ’': 12, 'æ–°ç«¹': 18, 'å°åŒ—': 25, 'æ–°åŒ—': 20,
            'æ–°èŠ': 15, 'æ¿æ©‹': 18, 'ä¸‰é‡': 16, 'è˜†ç«¹': 10, 'å¤§åœ’': 8, 'è§€éŸ³': 15,
            'é¾æ½­': 12, 'å¹³é®': 7, 'å…«å¾·': 10, 'é¾œå±±': 14
          };

          let estimatedDistance = 10;
          let matchedRoute = '';

          // å…ˆæª¢æŸ¥æ¥Šæ¢…å€ç‰¹å®šè·¯æ®µ
          for (const [route, distance] of Object.entries(yangmeiSpecificRoutes)) {
            if (customerAddress.includes(route)) {
              estimatedDistance = distance;
              matchedRoute = `æ¥Šæ¢…å€-${route}`;
              console.log(`åŒ¹é…åˆ°æ¥Šæ¢…å€è·¯æ®µ: ${route} = ${distance}å…¬é‡Œ`);
              break;
            }
          }

          // å†æª¢æŸ¥å¹³é®å€ç‰¹å®šè·¯æ®µ
          if (estimatedDistance === 10) {
            for (const [route, distance] of Object.entries(pingzhenSpecificRoutes)) {
              if (customerAddress.includes(route)) {
                estimatedDistance = distance;
                matchedRoute = `å¹³é®å€-${route}`;
                console.log(`åŒ¹é…åˆ°å¹³é®å€è·¯æ®µ: ${route} = ${distance}å…¬é‡Œ`);
                break;
              }
            }
          }

          // å¦‚æœæ²’æœ‰æ‰¾åˆ°ç‰¹å®šè·¯æ®µï¼Œå†æª¢æŸ¥å…¶ä»–å€åŸŸ
          if (estimatedDistance === 10) {
            for (const [area, distance] of Object.entries(areaEstimates)) {
              if (customerAddress.includes(area)) {
                estimatedDistance = distance;
                matchedRoute = `å…¶ä»–å€åŸŸ-${area}`;
                console.log(`åŒ¹é…åˆ°å…¶ä»–å€åŸŸ: ${area} = ${distance}å…¬é‡Œ`);
                break;
              }
            }
          }

          console.log(`å‚™ç”¨è¨ˆç®—è·é›¢: ${estimatedDistance}å…¬é‡Œ (åŒ¹é…è·¯æ®µ: ${matchedRoute || 'ç„¡åŒ¹é…'})`);

          // ä½¿ç”¨çµ±ä¸€çš„é¡¯ç¤ºå‡½æ•¸
          displayDistanceResult(estimatedDistance, false);
        }

        // éš±è—è·é›¢çµæœ
        function hideDistanceResult() {
          const distanceResult = document.getElementById('distance-result');
          distanceResult.style.display = 'none';
        }

        // æ›´æ–°å…é‹æé†’
        function updateShippingReminder(deliveryLevel) {
          const shippingReminder = document.getElementById('shipping-reminder');
          const shippingReminderContent = document.getElementById('shipping-reminder-content');

          if (!shippingReminder || !shippingReminderContent) return;

          // è¨ˆç®—ç•¶å‰è¨‚å–®ç¸½é‡‘é¡
          const currentTotal = currentOrder.reduce((sum, item) => sum + item.price, 0);
          const freeShippingAmount = deliveryLevel.freeShipping;
          const deliveryFee = deliveryLevel.fee;

          let reminderHTML = '';

          if (currentTotal >= freeShippingAmount) {
            // å·²é”æˆå…é‹æ¢ä»¶
            reminderHTML = `
              <div class="shipping-reminder-item">
                <span class="shipping-reminder-icon">ğŸ‰</span>
                <span class="shipping-reminder-text">æ­å–œï¼å·²é”æˆå…é‹æ¢ä»¶</span>
                <span class="shipping-reminder-amount achieved">âœ“ å…é‹</span>
              </div>
              <div class="shipping-reminder-item">
                <span class="shipping-reminder-icon">ğŸ’°</span>
                <span class="shipping-reminder-text">ç›®å‰è¨‚å–®é‡‘é¡ï¼š</span>
                <span class="shipping-reminder-amount achieved">$${currentTotal}</span>
              </div>
            `;
          } else {
            // æœªé”æˆå…é‹æ¢ä»¶
            const remainingAmount = freeShippingAmount - currentTotal;
            reminderHTML = `
              <div class="shipping-reminder-item">
                <span class="shipping-reminder-icon">ğŸ“Š</span>
                <span class="shipping-reminder-text">ç›®å‰è¨‚å–®é‡‘é¡ï¼š</span>
                <span class="shipping-reminder-amount">$${currentTotal}</span>
              </div>
              <div class="shipping-reminder-item">
                <span class="shipping-reminder-icon">ğŸ¯</span>
                <span class="shipping-reminder-text">é‚„å·® <span class="shipping-reminder-amount">$${remainingAmount}</span> é”æˆå…é‹</span>
              </div>
              <div class="shipping-reminder-item">
                <span class="shipping-reminder-icon">ğŸšš</span>
                <span class="shipping-reminder-text">æœªæ»¿é¡éœ€åŠ é‹è²»ï¼š</span>
                <span class="shipping-reminder-fee">$${deliveryFee}</span>
              </div>
              <div class="shipping-reminder-item">
                <span class="shipping-reminder-icon">ğŸ’³</span>
                <span class="shipping-reminder-text">å«é‹è²»ç¸½è¨ˆï¼š</span>
                <span class="shipping-reminder-amount">$${currentTotal + deliveryFee}</span>
              </div>
            `;
          }

          shippingReminderContent.innerHTML = reminderHTML;
          shippingReminder.style.display = 'block';
        }

        // ç²å–ç•¶å‰å¤–é€ç´šåˆ¥
        function getCurrentDeliveryLevel() {
          const deliveryAddress = document.getElementById('delivery-address');
          if (!deliveryAddress || deliveryAddress.value.trim().length <= 5) {
            return null;
          }

          const address = deliveryAddress.value.trim();

          // æ¥Šæ¢…å€ç‰¹å®šè·¯æ®µè·é›¢è¨­å®š
          const yangmeiSpecificRoutes = {
            'å¹¼ä¸‰è·¯': 4.7, 'å¹¼ç…è·¯': 4.7, 'å¹¼ç…å·¥æ¥­å€': 4.7,
            'å››ç¶­è·¯': 0.5, 'å¤§æˆè·¯': 1.2, 'æ–°æˆè·¯': 1.5,
            'æ°¸ç¾è·¯': 2.8, 'ä¸­å±±è·¯': 1.8, 'æ–‡åŒ–è¡—': 1.5,
            'æ¢…é«˜è·¯': 3.5, 'æ¢…ç…è·¯': 2.9, 'å¯Œå²¡': 5.2, 'æ¥Šæ¢…ç«è»Šç«™': 2.8,
            'ç‘åªè·¯': 3.8, 'é«˜æ¦®è·¯': 3.2, 'æ–°æ¦®è·¯': 2.8,
            'é‡‘é¾è·¯': 4.8, 'ç§€æ‰è·¯': 6.6, 'ä¸Šæ¹–è·¯': 6.2,
            'æ°´ç¾è·¯': 4.8, 'ä¸‰æ¹–è·¯': 5.8, 'é ­æ¹–è·¯': 6.5,
            'æ¥Šæ¹–è·¯': 4.2, 'ç‘åŸè·¯': 4.5, 'æ°¸æšè·¯': 3.8,
            'æ–°å¯Œè·¯': 5.2, 'å¯Œè±è·¯': 5.8, 'ç‘æºªè·¯': 4.8
          };

          // å¹³é®å€ç‰¹å®šè·¯æ®µè·é›¢è¨­å®š
          const pingzhenSpecificRoutes = {
            'å·¥æ¥­ä¸€è·¯': 4.5, 'å·¥æ¥­äºŒè·¯': 4.5, 'å·¥æ¥­ä¸‰è·¯': 4.5, 'å·¥æ¥­å››è·¯': 4.5,
            'å·¥æ¥­äº”è·¯': 4.5, 'å·¥æ¥­å…­è·¯': 4.5, 'å·¥æ¥­ä¸ƒè·¯': 4.5, 'å·¥æ¥­å…«è·¯': 4.5,
            'å·¥æ¥­ä¹è·¯': 4.5, 'å·¥æ¥­åè·¯': 4.5, 'å·¥æ¥­åä¸€è·¯': 4.5,
            'ä¸­è±è·¯': 5.5, 'ç’°å—è·¯': 6.8, 'æŒ¯èˆˆè·¯': 4.8,
            'å¾©èˆˆè¡—': 5.2, 'æ°‘æ—è·¯': 4.2, 'ä¸­æ­£è·¯': 5.8,
            'å»¶å¹³è·¯': 4.5, 'é‡‘é™µè·¯': 5.5, 'å»£æ³°è·¯': 6.8
          };

          // å…¶ä»–å€åŸŸè·é›¢ä¼°ç®—
          const areaEstimates = {
            'æ¥Šæ¢…': 3, 'ä¸­å£¢': 8, 'æ¡ƒåœ’': 12, 'æ–°ç«¹': 18, 'å°åŒ—': 25, 'æ–°åŒ—': 20,
            'æ–°èŠ': 15, 'æ¿æ©‹': 18, 'ä¸‰é‡': 16, 'è˜†ç«¹': 10, 'å¤§åœ’': 8, 'è§€éŸ³': 15,
            'é¾æ½­': 12, 'å¹³é®': 7, 'å…«å¾·': 10, 'é¾œå±±': 14
          };

          let estimatedDistance = 10;

          // å…ˆæª¢æŸ¥æ¥Šæ¢…å€ç‰¹å®šè·¯æ®µ
          for (const [route, distance] of Object.entries(yangmeiSpecificRoutes)) {
            if (address.includes(route)) {
              estimatedDistance = distance;
              break;
            }
          }

          // å†æª¢æŸ¥å¹³é®å€ç‰¹å®šè·¯æ®µ
          if (estimatedDistance === 10) {
            for (const [route, distance] of Object.entries(pingzhenSpecificRoutes)) {
              if (address.includes(route)) {
                estimatedDistance = distance;
                break;
              }
            }
          }

          // å¦‚æœæ²’æœ‰æ‰¾åˆ°ç‰¹å®šè·¯æ®µï¼Œå†æª¢æŸ¥å…¶ä»–å€åŸŸ
          if (estimatedDistance === 10) {
            for (const [area, distance] of Object.entries(areaEstimates)) {
              if (address.includes(area)) {
                estimatedDistance = distance;
                break;
              }
            }
          }

          return getDeliveryLevel(estimatedDistance);
        }

        // æ ¹æ“šè·é›¢ç²å–å¤–é€ç´šåˆ¥
        function getDeliveryLevel(distanceKm) {
          for (let i = 0; i < deliveryFeeData.length; i++) {
            const level = deliveryFeeData[i];
            const maxDistance = parseInt(level.distance.match(/\d+/)[0]);

            if (distanceKm <= maxDistance) {
              let levelClass = 'level-low';
              if (maxDistance >= 15) levelClass = 'level-max';
              else if (maxDistance >= 10) levelClass = 'level-high';
              else if (maxDistance >= 5) levelClass = 'level-medium';

              return {
                distance: level.distance,
                fee: level.fee,
                freeShipping: level.freeShipping,
                minOrder: level.minOrder,
                levelClass: levelClass
              };
            }
          }

          return {
            distance: "è¶…é20å…¬é‡Œ",
            fee: 300,
            freeShipping: 2400,
            minOrder: 1200,
            levelClass: 'level-max'
          };
        }

        // èœå–®æŸ¥çœ‹åŠŸèƒ½
        function initMenuViewer() {
          const menuModal = document.getElementById('menu-modal');
          const viewMenuBtn = document.getElementById('view-menu-btn');
          const closeMenuBtn = document.getElementById('close-menu-modal');

          if (viewMenuBtn && menuModal) {
            // é–‹å•Ÿèœå–®æ¨¡æ…‹æ¡†
            viewMenuBtn.addEventListener('click', () => {
              menuModal.style.display = 'block';
            });
          }

          if (closeMenuBtn && menuModal) {
            // é—œé–‰èœå–®æ¨¡æ…‹æ¡†
            closeMenuBtn.addEventListener('click', () => {
              menuModal.style.display = 'none';
            });
          }

          if (menuModal) {
            // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
            menuModal.addEventListener('click', (e) => {
              if (e.target === menuModal) {
                menuModal.style.display = 'none';
              }
            });
          }
        }

        // åˆå§‹åŒ–æ‡‰ç”¨
        initMenu();
        updateOrderDisplay();
        updateOrderPreview();
        updateLoadOrdersButton();
        initMenuViewer();

        // åˆå§‹åŒ–è·é›¢è¨ˆç®—åŠŸèƒ½
        initDistanceCalculation();
      </script>
    </div>
  </body>

</html>
